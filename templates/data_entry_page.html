{% extends "base.html" %}

{% block title %}Data Entry{% endblock %}

{% block extra_head %}
<style>

#bmc-edit-submit {
    transition: background 0.2s, transform 0.18s, box-shadow 0.18s;
}
#bmc-edit-submit:hover {
    background: #d1bfa5; /* darker shade */
    transform: scale(1.07);
    box-shadow: 0 4px 18px rgba(9,107,104,0.13);
}
.pdf-viewer-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    overflow: auto;
    padding: 20px;
    box-sizing: border-box;
}

.pdf-viewer-container {
    background: white;
    border-radius: 10px;
    width: 90%;
    max-width: 1200px;
    height: 90%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 5px 30px rgba(0,0,0,0.3);
}


.pdf-viewer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    flex-shrink: 0;
}


.pdf-viewer-title {
    font-size: 1.5rem;
    color: #096B68;
    margin: 0;
}


.pdf-viewer-close {
    background: none;
    border: none;
    font-size: 1.8rem;
    cursor: pointer;
    color: #096B68;
    padding: 5px 10px;
    line-height: 1;
}

.pdf-viewer-close:hover {
    color: #333;
}

.pdf-viewer-content {
    flex: 1;
    overflow: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.pdf-page-container {
    margin-bottom: 20px;
    width: 100%;
    max-width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.pdf-page-number {
    text-align: center;
    padding: 8px;
    background: #f5f5f5;
    color: #096B68;
    font-size: 0.9rem;
    width: 100%;
    border-radius: 5px 5px 0 0;
}

.pdf-navigation {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 15px;
    flex-shrink: 0;
    background: #f9f9f9;
    border-radius: 0 0 10px 10px;
}

.pdf-nav-button {
    background: #096B68;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 20px;
    cursor: pointer;
    font-size: 1rem;
    min-width: 100px;
}

.pdf-nav-button:disabled {
    background: #cccccc;
    cursor: not-allowed;
}


.pdf-current-page {
    margin: 0 15px;
    align-self: center;
    font-weight: bold;
    color: #555;
}

/* --- Other styles (unchanged) --- */
.user-profile-card {
    background: #C1DBB3;
    border-radius: 20px;
    width: 250px;
    padding: 32px 20px;
    margin: 10px 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.profile-picture {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: #096B68;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2.5rem;
    margin: 10px 0; /* Add vertical margin for spacing */
    padding: 10px 10px 10px 10px;
}

.user-email {
    font-size: 0.9rem;
    color: #333;
    margin-bottom: 20px;
    word-break: break-all;
    text-align: center;
}

.profile-buttons {
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 10px;
}

.profile-btn {
    background: #F2C078;
    border: none;
    border-radius: 8px;
    padding: 10px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    width: 100%;
    text-align: center;
}

.profile-btn:hover {
    background: #e6b86a;
}

.profile-btn.edit {
    background: #096B68;
    color: white;
}

.profile-btn.edit:hover {
    background: #0a5a57;
}

.aside-card {
    background: #C1DBB3;
    border-radius: 20px;
    width: 350px;
    padding: 32px 0;
    margin: 10px 0 10px 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    display: flex;
    flex-direction: column;
    align-items: stretch;
}
.aside-item {
    background: #F2C078;
    border-radius: 12px;
    margin: 12px 24px;
    padding: 18px 24px;
    font-weight: 400;
    font-size: 1.1rem;
    color: #333;
    transition: transform 0.2s;
    cursor: pointer;
    text-align: left;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
}
.aside-item:hover {
    transform: scale(1.07);
    z-index: 1;
}
.dropdown-icon {
    margin-left: 10px;
    font-size: 1.1rem;
    transition: transform 0.2s;
}
.aside-subitems {
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    flex-direction: column;
    margin-left: 36px;
    margin-right: 24px;
    margin-top: 4px;
    transition: opacity 0.3s, max-height 0.3s;
    display: flex;
    pointer-events: none;
}
.aside-subitem {
    background: #F2C078;
    border-radius: 10px;
    margin: 6px 0;
    padding: 12px 18px;
    font-size: 1rem;
    color: #444;
    font-weight: 400;
    cursor: pointer;
    transition: transform 0.2s;
}
.aside-subitem:hover {
    transform: scale(1.05);
    z-index: 1;
}
.aside-item.open .dropdown-icon {
    transform: rotate(90deg);
}
.aside-item.open + .aside-subitems {
    opacity: 1;
    max-height: 400px;
    pointer-events: auto;
}

/* Form styles */
.form-card {
    background: #096B68;
    border-radius: 20px;
    margin: 10px 0 10px 32px;
    padding: 32px 32px 24px 32px;
    flex: 1;
    display: none;
    min-width: 0;
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    align-self: stretch;
    color: #fff;
    animation: fadeIn 0.3s;
    position: relative;
}
.form-success-message {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 1001;
    background: #FFE8CD;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.12);
    margin: 0;
    padding: 0;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px);}
    to { opacity: 1; transform: none;}
}
.form-card.active {
    display: block;
}
.form-card.success-active {
    background: transparent !important;
    box-shadow: none !important;
}
.form-title {
    font-size: 1.3rem;
    font-weight: 500;
    margin-bottom: 24px;
    letter-spacing: 1px;
}
.form-row {
    display: flex;
    gap: 24px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.form-group {
    flex: 1 1 22%;
    min-width: 180px;
    display: flex;
    flex-direction: column;
}
.form-label {
    font-size: 1rem;
    margin-bottom: 6px;
    color: #fff;
    font-weight: 400;
}
.form-input {
    background: #FAE3C6;
    border: none;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 1rem;
    color: #333;
    margin-bottom: 2px;
    outline: none;
    transition: box-shadow 0.2s;
}
.form-input:focus {
    box-shadow: 0 0 0 2px #F2C078;
}
.form-actions {
    margin-top: 18px;
    display: flex;
    justify-content: flex-end;
}
.form-btn {
    background: #F2C078;
    color: #333;
    border: none;
    border-radius: 8px;
    padding: 10px 28px;
    font-size: 1.1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}
.form-btn:hover {
    background: #e6b86a;
}

/* Upload section styles */
.upload-section {
    margin: 30px 0;
    padding: 20px 0;
}
.upload-title {
    font-size: 1.2rem;
    margin-bottom: 20px;
    text-align: center;
}
.upload-container {
    border: 2px dashed #FAE3C6;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    margin-bottom: 20px;
    position: relative;
}
.upload-filename {
    font-size: 0.95rem;
    color: #ffffff;
    margin-top: 6px;
    word-break: break-all;
    font-style: italic;
}
.file-input {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
}
.upload-label {
    display: inline-block;
    background: #F2C078;
    color: #333;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}
.upload-label:hover {
    background: #e6b86a;
}
.upload-instructions {
    margin-top: 15px;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.8);
}
.upload-submit {
    text-align: center;
    margin-top: 20px;
}
/* Selection prompt styles */
.selection-prompt {
    position: absolute;
    top: 50%;
    left: calc(350px + 20px); /* Position after the aside card */
    right: 20px; /* 20px padding on the right */
    transform: translateY(-50%);
    background: rgba(9, 107, 104, 0.9);
    padding: 30px 40px;
    border-radius: 20px;
    text-align: center;
    color: white;
    font-size: 1.5rem;
    font-weight: 500;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    z-index: 10;
    height: auto;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-left: 32px; /* Same as form-card margin */
    margin-top: 50px; /* <-- Add this line to give space below the top banner card */
}

.selection-prompt i {
    font-size: 3rem;
    margin-bottom: 20px;
    display: block;
    color: #F2C078;
}
input[placeholder]::placeholder {
    color: #968C83 !important;
    opacity: 1;
}

.form-input[name="expired"],
.form-input[name="fssai_status"],
.form-input[name="disclaimer"] {
    background: #F2C078;
    color: #333;
    border-radius: 8px;
    border: 1.5px solid #e6b86a;
    font-weight: 500;
    font-size: 1rem;
    transition: transform 0.18s, box-shadow 0.18s, border-color 0.18s;
    box-shadow: 0 1px 6px rgba(9,107,104,0.07);
    cursor: pointer;
    outline: none;
}

.form-input[name="expired"]:hover,
.form-input[name="expired"]:focus,
.form-input[name="fssai_status"]:hover,
.form-input[name="fssai_status"]:focus,
.form-input[name="disclaimer"]:hover,
.form-input[name="disclaimer"]:focus {
    transform: scale(1.07);
    box-shadow: 0 4px 18px rgba(9,107,104,0.13);
    border-color: #F2C078;
    background: #ffe7b8;
    z-index: 2;
}
.top-banner-card {
    background: #C1DBB3;;
    border-radius: 20px;
    height: 100px;
    margin: 20px;
    width: calc(100% - 40px);
    box-sizing: border-box;
}
.tick-animate polyline {
  stroke-dasharray: 40;
  stroke-dashoffset: 40;
  animation: tick-draw 0.7s cubic-bezier(.68,-0.55,.27,1.55) forwards;
}
@keyframes tick-draw {
  to {
    stroke-dashoffset: 0;
  }
}
@keyframes tick-pop {
    0% {
        transform: scale(0.2) rotate(-30deg);
        opacity: 0;
    }
    60% {
        transform: scale(1.2) rotate(10deg);
        opacity: 1;
    }
    80% {
        transform: scale(0.95) rotate(-5deg);
    }
    100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
}
.form-success-message .tick-animate {
    animation: tick-pop 0.7s cubic-bezier(.68,-0.55,.27,1.55);
    display: block;
}
/* Smoother zoom and drop for expandable cards */
.expandable-card {
    transition: 
        transform 0.35s cubic-bezier(.68,-0.55,.27,1.25), 
        box-shadow 0.35s cubic-bezier(.68,-0.55,.27,1.25);
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    will-change: transform;
}
.expandable-card:hover,
.expandable-card.expanded {
    transform: scale(1.035) translateY(-6px);
    box-shadow: 0 8px 32px rgba(90,130,126,0.18);
    z-index: 2;
}
.expandable-content {
    transition: 
        max-height 0.45s cubic-bezier(.68,-0.55,.27,1.25), 
        opacity 0.35s cubic-bezier(.68,-0.55,.27,1.25);
    overflow: hidden;
    max-height: 0;
    opacity: 0;
}
 .expandable-content {
    max-height: 300px; /* adjust as needed */
    opacity: 1;
    animation: dropDownAnim 0.45s cubic-bezier(.68,-0.55,.27,1.25);
}
@keyframes dropDownAnim {
    0% { transform: translateY(-30px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}
.tooltip {
        position: absolute; 
        bottom: -35px; 
        left: 50%; 
        transform: translateX(-50%); 
        background: #333; 
        color: white; 
        padding: 5px 10px; 
        border-radius: 4px; 
        font-size: 12px; 
        opacity: 0; 
        transition: opacity 0.3s; 
        pointer-events: none; 
        white-space: nowrap;
    }
</style>
{% endblock %}

{% block content %}
<div class="top-banner-card" style="display: flex; align-items: center; padding-left: 20px; position: relative;">
    <!-- Profile Circle with Profile Picture -->
    <div class="profile-picture" style="margin: 0 20px 0 0; padding: 0; overflow: hidden; position: relative; align-self: center;">
        {% if user.profile_picture %}
            <img src="{{ user.profile_picture.url }}" alt="Profile Picture" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
        {% else %}
            <span style="font-size:2.5rem; color:white;">{{ user.first_name|default:"U"|first|upper }}</span>
        {% endif %}
    </div>
    <!-- User Info -->
    <div style="display: flex; flex-direction: column; justify-content: center; position: relative; padding-right: 20px;">
        <div style="font-size: 1.3rem; font-weight: 600; color: #096B68;">
            {{ user.first_name }} {{ user.last_name }}
        </div>
        <div style="font-size: 1rem; color: #555;">
            Employee ID: {{ user.employee_code }}
        </div>
    </div>
    <!-- Refresh Button -->
    <div id="refreshIcon" style="
        cursor: pointer; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        width: 40px; 
        height: 40px; 
        background-color: #708A58; 
        border-radius: 50%; 
        margin-left: 20px; 
        position: relative; 
        transition: transform 0.3s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    ">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 16 16" style="transition: transform 0.3s;">
            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
        </svg>
        <span class="tooltip">Hard Refresh</span>
    </div>
    <!-- INSERT and EDIT text -->
    <div style="position: absolute; right: 40px; top: 50%; transform: translateY(-50%); display: flex; gap: 32px;">
        <span id="insertBtn" style="font-size: 1.1rem; font-weight: 600; color: #096B68; letter-spacing: 2px; cursor: pointer;">INSERT</span>
        <span id="editBtn" style="font-size: 1.1rem; font-weight: 600; color: #096B68; letter-spacing: 2px; cursor: pointer;">EDIT</span>
        <span id="viewBtn" style="font-size: 1.1rem; font-weight: 600; color: #096B68; letter-spacing: 2px; cursor: pointer;">VIEW</span>
    </div>
</div>


<div style="display: flex; justify-content: flex-start; align-items: flex-start;">
    <aside class="aside-card">
        <div class="aside-item" onclick="showForm('amc'); scrollToTop()">AMC AGREEMENT</div>
        <div class="aside-item" onclick="showForm('bmc'); scrollToTop()">BMC AGREEMENT</div>
        <div class="aside-item" onclick="showForm('input_services'); scrollToTop()">INPUT SERVICES AGREEMENT</div>
        <div class="aside-item" onclick="showForm('consultant'); scrollToTop()">CONSULTANT AGREEMENT</div>
        <div class="aside-item" onclick="showForm('cook'); scrollToTop()">COOK AGREEMENT</div>
        <div class="aside-item" onclick="showForm('distributer'); scrollToTop()">DISTRIBUTER AGREEMENT</div>
        <div class="aside-item" onclick="showForm('inward'); scrollToTop()">INWARD TRANSPORT AGREEMENT</div>
        <div class="aside-item" onclick="showForm('outward'); scrollToTop()">OUTWARD TRANSPORT AGREEMENT</div>
        <div class="aside-item" onclick="showForm('milk_sale'); scrollToTop()">MILK SALE AGREEMENT</div>
        <div class="aside-item" onclick="showForm('mcc'); scrollToTop()">MCC AGREEMENT</div>
        <div class="aside-item" onclick="showForm('mpacs'); scrollToTop()">MPACS AGREEMENT</div>
        <div class="aside-item" onclick="showForm('mpp_sahayak'); scrollToTop()">MPP/SAHAYAK AGREEMENT</div>
        <div class="aside-item" onclick="showForm('rta'); scrollToTop()">RTA AGREEMENT</div>
        <div class="aside-item" id="rental-toggle" onclick="toggleDropdown(this);">
            RENTAL AGREEMENT
            <span class="dropdown-icon"><i class="fa-solid fa-chevron-right"></i></span>
        </div>
        
        <div class="aside-subitems" id="rental-subitems">
            <div class="aside-subitem" onclick="showForm('godown'); scrollToTop()">GODOWN/STORE</div>
            <div class="aside-subitem" onclick="showForm('office_lease'); scrollToTop()">OFFICE LEASE</div>
            <div class="aside-subitem" onclick="showForm('guest_house'); scrollToTop()">GUEST HOUSE AGREEMENT</div>
        </div>
    </aside>
     <!-- Selection prompt that shows when no form is selected -->
    <div class="selection-prompt" id="selectionPrompt" style="display: none;">
        <i class="fas fa-hand-point-left"></i>
        PLEASE CLICK ON THE DOCUMENT NAME YOU WANT TO ENTER THE DOCUMENTS
    </div>
    <div class="selection-prompt" id="editSelectionPrompt" style="display:none;">
    <i class="fas fa-hand-point-left"></i>
    PLEASE CLICK ON THE DOCUMENT NAME YOU WANT TO EDIT THE DOCUMENTS
</div>
    <!-- Example: AMC Agreement Form -->
    <div class="form-card" id="amc-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">AMC Agreement Entry Form</div>
        <form method="post" enctype="multipart/form-data" action="{% url 'amc-create' %}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Product</label>
                    <input class="form-input" type="text" name="product">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <div class="form-card" id="amc-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="amc-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: AMC AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL AMC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="amc-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE AMC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="amc-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE AMC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="amc-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="amc-search-input"
                    type="text"
                    placeholder="SEARCH BY TYPING CONTRACTOR, PRODUCT NAME"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="amc-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; cursor: pointer; pointer-events: auto;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="amc-search-result"></div>
        </div>
    </div>
</div>
    <!-- BMC AGREEMENT FROM -->
    <div class="form-card" id="bmc-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">BMC Agreement Entry Form</div>
        <form method="post" enctype="multipart/form-data" action="{% url 'bmc-create' %}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
            </div>
            
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png" required>
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <div class="form-card" id="bmc-edit-card" style="display:none;">
        <div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: BMC AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <!-- Left: TOTAL BMC AGREEMENT -->
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL BMC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="bmc-total-count">0</span>
                </span>
            </div>
            <!-- Center: TOTAL COMPLETE BMC AGREEMENT -->
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE BMC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="bmc-complete-count">0</span>
                </span>
            </div>
            <!-- Right: TOTAL INCOMPLETE BMC AGREEMENT -->
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE BMC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="bmc-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box BELOW the stats row -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="amc-search-icon"
                    type="text"
                    placeholder="SEARCH BY LOCATION"
                    style="
                        width: 100%;
                        background: #FFEDDB;
                        border: none;
                        border-radius: 24px;
                        padding: 12px 44px 12px 18px;
                        font-size: 1rem;
                        color: #000;
                        outline: none;
                        box-sizing: border-box;
                        font-weight: 500;
                    "
                />
                <!-- Search Icon (Font Awesome, tilted) -->
                <span style="
                    position: absolute;
                    right: 16px;
                    top: 50%;
                    transform: translateY(-50%) rotate(-20deg);
                    color: #2C2C2C;
                    font-size: 1.2rem;
                    pointer-events: none;
                ">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="bmc-search-result"></div>
        </div>
        <!-- Continue with the rest of your card content here -->
    </div>
</div>
<!-- INPUT SERVICES AGREEMENT  -->
<div class="form-card" id="input_services-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">INPUT SERVICES AGREEMENT Entry Form</div>
        <form method="post" enctype="multipart/form-data" action="{% url 'input_services-create' %}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Product</label>
                    <input class="form-input" type="text" name="product">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
     <!-- Place after the INPUT SERVICES AGREEMENT form -->
<div class="form-card" id="input_services-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="input_services-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: INPUT SERVICES AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL INPUT SERVICES AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="input_services-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE INPUT SERVICES AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="input_services-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE INPUT SERVICES AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="input_services-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <!-- Inside #input_services-edit-card, after the stats row -->
<div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
    <div style="position: relative; width: 100%;">
        <input
            id="input_services-search-input"
            type="text"
            placeholder="SEARCH BY TYPING CONTRACTOR, PRODUCT NAME"
            style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
        />
        <span id="input_services-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; cursor: pointer; pointer-events: auto;">
            <i class="fas fa-search"></i>
        </span>
    </div>
    <div id="input_services-search-result"></div>
</div>
    </div>
</div>
    <!-- Consultant Agreement form -->
    <div class="form-card" id="consultant-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Consultant Agreement Entry Form</div>
        <form method="post" enctype="multipart/form" action="{% url 'consultant-create'%}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <input class="form-input" type="text" name="category">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the CONSULTANT form -->
     <div class="form-card" id="consultant-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="consultant-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: CONSULTANT AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL CONSULTANT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="consultant-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE CONSULTANT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="consultant-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE CONSULTANT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="consultant-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="consultant-search-input"
                    type="text"
                    placeholder="SEARCH BY CATEGORY, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="consultant-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="consultant-search-result"></div>
        </div>
    </div>
</div>
    <!-- COOK AGREEMENT FORM -->
    <div class="form-card" id="cook-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Cook Agreement Entry Form</div>
        <form method="post" enctype="multipart/form" action="{% url 'cook-create'%}">
            <div class="form-row">
                {% csrf_token %}
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the COOK form -->
     <div class="form-card" id="cook-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="cook-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: COOK AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL COOK AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="cook-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE COOK AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="cook-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE COOK AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="cook-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="cook-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="cook-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="cook-search-result"></div>
        </div>
    </div>
</div>

<!-- INWARD TRANSPORT AGREEMENT FORM -->
<div class="form-card" id="inward-form">
    <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
    <div class="form-title">Inward Transport Agreement Entry Form</div>
    <form>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Location</label>
                <input class="form-input" type="text" name="location">
            </div>
            <div class="form-group">
                <label class="form-label">Route</label>
                <input class="form-input" type="text" name="route">
            </div>
            <div class="form-group">
                <label class="form-label">Unique Code</label>
                <input class="form-input" type="text" name="unique_code">
            </div>
            <div class="form-group">
                <label class="form-label">Particular</label>
                <input class="form-input" type="text" name="particular">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Mobile</label>
                <input class="form-input" type="text" name="mobile">
            </div>
            <div class="form-group">
                <label class="form-label">Effective Date</label>
                <input class="form-input" type="date" name="effective_date">
            </div>
            <div class="form-group">
                <label class="form-label">Term</label>
                <input class="form-input" type="text" name="term">
            </div>
            <div class="form-group">
                <label class="form-label">Expiry Date</label>
                <input class="form-input" type="date" name="expiry_date">
            </div>
        </div>
        <div class="form-row">
             <div class="form-group">
        <label class="form-label">Expired</label>
        <select class="form-input" name="expired" required>
            <option value="" disabled selected>Select Status</option>
            <option value="OK">OK</option>
            <option value="CLOSED">CLOSED</option>
            <option value="EXPIRED">EXPIRED</option>
            <option value="PENDING">PENDING</option>
            <option value="DOCUMENT PENDING">DOCUMENT PENDING</option>
        </select>
    </div>
            <div class="form-group">
                <label class="form-label">Bank Name</label>
                <input class="form-input" type="text" name="bank_name">
            </div>
            <div class="form-group">
                <label class="form-label">Account No.</label>
                <input class="form-input" type="text" name="account_no">
            </div>
            <div class="form-group">
                <label class="form-label">Bank IFSC Code</label>
                <input class="form-input" type="text" name="bank_ifsc_code">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Aadhar</label>
                <input class="form-input" type="text" name="aadhar">
            </div>
            <div class="form-group">
                <label class="form-label">Pan</label>
                <input class="form-input" type="text" name="pan">
            </div>
            <div class="form-group">
                <label class="form-label">VEH. NO.</label>
                <input class="form-input" type="text" name="veh_no">
            </div>
            <div class="form-group">
                <label class="form-label">Veh Reg Date</label>
                <input class="form-input" type="date" name="veh_reg_date">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Insurance UPTO</label>
                <input class="form-input" type="date" name="insurance_upto">
            </div>
            <div class="form-group">
                <label class="form-label">Pollution</label>
                <input class="form-input" type="text" name="pollution">
            </div>
            <div class="form-group">
                <label class="form-label">Fitness Certificate</label>
                <input class="form-input" type="text" name="fitness_certificate">
            </div>
            <div class="form-group">
                <label class="form-label">FSSAI</label>
                <input class="form-input" type="text" name="fssai">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">FSSAI Status</label>
                <select class="form-input" name="fssai_status" id="">
            <option value="" disabled selected>Select Status</option>
            <option value="OK">OK</option>
            <option value="PENDING">PENDING</option>
            <option value="CLOSED">CLOSED</option>
            <option value="APPLY">APPLY</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">DISCLAIMER</label>
                <select class="form-input" name="disclaimer" id="">
            <option value="" disabled selected>Select Disclaimer</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">FSSAI UPTO</label>
                <input class="form-input" type="date" name="fssai_upto">
            </div>
            <div class="form-group" style="flex: 2 1 100%;">
                <label class="form-label">Remark</label>
                <input class="form-input" type="text" name="remark">
            </div>
            
        </div>
        <div class="upload-section">
            <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
            <div class="upload-container">
                <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                <label class="upload-label">CHOOSE FILE</label>
                <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
            </div>
            <div class="upload-submit">
                <button type="submit" class="form-btn">Submit</button>
            </div>
        </div>
    </form>
</div>
<!-- Place after the INWARD TRANSPORT AGREEMENT form -->
 <div class="form-card" id="#" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="inward-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: INWARD TRANSPORT AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL INWARD AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="inward-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE INWARD TRANSPORT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="inward-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE INWARD AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="inward-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    type="text"
                    placeholder="SEARCH BY LOCATION"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="inward-search-result"></div>
        </div>
    </div>
</div>

<!-- OUTWARD TRANSPORT AGREEMENT FORM -->
 <div class="form-card" id="outward-form">
    <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
    <div class="form-title">Outward Transport Agreement Entry Form</div>
    <form>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Location</label>
                <input class="form-input" type="text" name="location">
            </div>
            <div class="form-group">
                <label class="form-label">Route</label>
                <input class="form-input" type="text" name="route">
            </div>
            <div class="form-group">
                <label class="form-label">Unique Code</label>
                <input class="form-input" type="text" name="unique_code">
            </div>
            <div class="form-group">
                <label class="form-label">Particular</label>
                <input class="form-input" type="text" name="particular">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Mobile</label>
                <input class="form-input" type="text" name="mobile">
            </div>
            <div class="form-group">
                <label class="form-label">Effective Date</label>
                <input class="form-input" type="date" name="effective_date">
            </div>
            <div class="form-group">
                <label class="form-label">Term</label>
                <input class="form-input" type="text" name="term">
            </div>
            <div class="form-group">
                <label class="form-label">Expiry Date</label>
                <input class="form-input" type="date" name="expiry_date">
            </div>
        </div>
        <div class="form-row">
             <div class="form-group">
        <label class="form-label">Expired</label>
        <select class="form-input" name="expired" required>
            <option value="" disabled selected>Select Status</option>
            <option value="OK">OK</option>
            <option value="CLOSED">CLOSED</option>
            <option value="EXPIRED">EXPIRED</option>
            <option value="PENDING">PENDING</option>
            <option value="DOCUMENT PENDING">DOCUMENT PENDING</option>
        </select>
    </div>
            <div class="form-group">
                <label class="form-label">Bank Name</label>
                <input class="form-input" type="text" name="bank_name">
            </div>
            <div class="form-group">
                <label class="form-label">Account No.</label>
                <input class="form-input" type="text" name="account_no">
            </div>
            <div class="form-group">
                <label class="form-label">Bank IFSC Code</label>
                <input class="form-input" type="text" name="bank_ifsc_code">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Aadhar</label>
                <input class="form-input" type="text" name="aadhar">
            </div>
            <div class="form-group">
                <label class="form-label">Pan</label>
                <input class="form-input" type="text" name="pan">
            </div>
            <div class="form-group">
                <label class="form-label">VEH. NO.</label>
                <input class="form-input" type="text" name="veh_no">
            </div>
            <div class="form-group">
                <label class="form-label">Veh Reg Date</label>
                <input class="form-input" type="date" name="veh_reg_date">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Insurance UPTO</label>
                <input class="form-input" type="date" name="insurance_upto">
            </div>
            <div class="form-group">
                <label class="form-label">Pollution</label>
                <input class="form-input" type="text" name="pollution">
            </div>
            <div class="form-group">
                <label class="form-label">Fitness Certificate</label>
                <input class="form-input" type="text" name="fitness_certificate">
            </div>
            <div class="form-group">
                <label class="form-label">FSSAI</label>
                <input class="form-input" type="text" name="fssai">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">FSSAI Status</label>
                <select class="form-input" name="fssai_status" id="">
            <option value="" disabled selected>Select Status</option>
            <option value="OK">OK</option>
            <option value="PENDING">PENDING</option>
            <option value="CLOSED">CLOSED</option>
            <option value="APPLY">APPLY</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">DISCLAIMER</label>
                <select class="form-input" name="disclaimer" id="">
            <option value="" disabled selected>Select Disclaimer</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">FSSAI UPTO</label>
                <input class="form-input" type="date" name="fssai_upto">
            </div>
            <div class="form-group" style="flex: 2 1 100%;">
                <label class="form-label">Remark</label>
                <input class="form-input" type="text" name="remark">
            </div>
        </div>
        <div class="upload-section">
            <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
            <div class="upload-container">
                <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                <label class="upload-label">CHOOSE FILE</label>
                <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
            </div>
            <div class="upload-submit">
                <button type="submit" class="form-btn">Submit</button>
            </div>
        </div>
    </form>
</div>
<!-- Place after the OUTWARD TRANSPORT AGREEMENT form -->
<div class="form-card" id="#" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="outward-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: OUTWARD TRANSPORT AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL OUTWARD TRANSPORT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="outward-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE OUUTWARD TRANSPORT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="outward-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE OUTWARD TRANSPORT AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="outward-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    type="text"
                    placeholder="SEARCH BY LOCATION"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="outward-search-result"></div>
        </div>
    </div>
</div>

     <!-- DISTRIBUTOR AGREEMENT FORM -->
    <div class="form-card" id="distributer-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Distributer Agreement Entry Form</div>
                <form method="post" enctype="multipart/form" action="{% url 'distributer-create'%}">
                    {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the DISTRIBUTER form -->
     <div class="form-card" id="distributer-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="distributer-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: DISTRIBUTER AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL DISTRIBUTER AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="distributer-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE DISTRIBUTER AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="distributer-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE DISTRIBUTER AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="distributer-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="distributer-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="distributer-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="distributer-search-result"></div>
        </div>
    </div>
</div>
    <!-- MILK SALE AGREEMENT FORM -->
    <div class="form-card" id="milk_sale-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Milk Sale Agreement Entry Form</div>
        <form method="post" enctype="multipart/form" action="{% url 'milk_sale-create'%}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the MILK SALE form -->
     <div class="form-card" id="milk_sale-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
                <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
                    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
                    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="milk_sale-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: MILK SALE AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL MILK SALE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="milk_sale-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE MILK SALE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="milk_sale-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE MILK SALE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="milk_sale-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="milk_sale-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="milk_sale-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="milk_sale-search-result"></div>
        </div>
    </div>
</div>
    <!-- MCC AGREEMENT FORM -->
    <div class="form-card" id="mcc-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">MCC Agreement Entry Form</div>
        <form method="post" enctype="multipart/form" action="{% url 'mcc-create'%}">
        {%csrf_token%}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
            <!-- Place after the MCC form -->
<div class="form-card" id="mcc-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
            <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
            <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="mcc-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: MCC AGREEMENT
        </div>
        
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL MCC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="mcc-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE MCC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="mcc-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE MCC AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="mcc-incomplete-count">0</span>
                </span>
            </div>
        </div>
        
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="mcc-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="mcc-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="mcc-search-result"></div>
        </div>
    </div>
</div>
    <!-- MPACS AGREEMENT FORM -->
    <div class="form-card" id="mpacs-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">MPACS Agreement Entry Form</div>
        <form method="post" enctype="multipart/form" action="{% url 'mpacs-create'%}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the MPACS form -->
    <div class="form-card" id="mpacs-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
            <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
            <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="mpacs-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: MPACS AGREEMENT
        </div>
        
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL MPACS AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="mpacs-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE MPACS AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="mpacs-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE MPACS AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="mpacs-incomplete-count">0</span>
                </span>
            </div>
        </div>
        
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="mpacs-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="mpacs-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="mpacs-search-result"></div>
        </div>
    </div>
</div>
   

    <!-- Rental GODOWN AGREEMENT ENTRY FORM -->
    <div class="form-card" id="godown-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Godown Agreement Entry Form</div>
        <form method="post", enctype="multipart/form-data", action="{% url 'godown-create' %}">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the GODOWN AGREEMENT form -->
<div class="form-card" id="godown-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
            <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
            <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="godown-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: GODOWN AGREEMENT
        </div>
        
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL GODOWN AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="godown-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE GODOWN AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="godown-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE GODOWN AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="godown-incomplete-count">0</span>
                </span>
            </div>
        </div>
        
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="godown-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="godown-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="godown-search-result"></div>
        </div>
    </div>
</div>
    <!-- Office Lease Form -->
    <div class="form-card" id="office_lease-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Office Lease Entry Form</div>
        <form>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the OFFICE LEASE form -->
     <div class="form-card" id="office_lease-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="office_lease-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: OFFICE LEASE AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL OFFICE LEASE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="office_lease-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE OFFICE LEASE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="office_lease-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE OFFICE LEASE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="office_lease-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    type="text"
                    placeholder="SEARCH BY LOCATION"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="office_lease-search-result"></div>
        </div>
    </div>
</div>
    <!-- GUEST HOUSE AGREEMENT FORM  -->
    <div class="form-card" id="guest_house-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
        <div class="form-title">Guest House Entry Form</div>
        <form>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the AMC form -->
     <div class="form-card" id="guest_house-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="guest_house-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: GUEST HOUSE AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL GUEST HOUSE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="guest_house-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE GUEST HOUSE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="guest_house-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE GUEST HOUSE AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="guest_house-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    type="text"
                    placeholder="SEARCH BY LOCATION"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="guest_house-search-result"></div>
        </div>
    </div>
</div>
    <div class="form-card" id="rta-form">
        <!-- Place this inside each .form-card, after the <form> -->
            <div class="form-success-message" style="display:none;">
                <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
                    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
                    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
            </div>
            <div class="form-title">RTA Entry Form</div>
            <form method="post" enctype="multipart/form-data" action="{% url 'rta-create' %}">
                {% csrf_token %}
                <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Zone</label>
                    <input class="form-input" type="text" name="zone">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input class="form-input" type="text" name="location">
                </div>
                <div class="form-group">
                    <label class="form-label">Contractor</label>
                    <input class="form-input" type="text" name="contractor">
                </div>
                <div class="form-group">
                    <label class="form-label">PAN</label>
                    <input class="form-input" type="text" name="pan">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type of Agreement</label>
                    <input class="form-input" type="text" name="type_of_agreement">
                </div>
                <div class="form-group">
                    <label class="form-label">Agreement Date</label>
                    <input class="form-input" type="date" name="agreement_date">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input class="form-input" type="date" name="start_date">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input class="form-input" type="date" name="end_date">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tenure (months)</label>
                    <input class="form-input" type="number" name="tenure_months">
                </div>
                <div class="form-group">
                    <label class="form-label">Lock-in Period</label>
                    <input class="form-input" type="text" name="lock_in_period">
                </div>
                <div class="form-group">
                    <label class="form-label">Monthly Payout</label>
                    <input class="form-input" type="text" name="monthly_payout">
                </div>
                <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
            </div>
            <div class="upload-section">
                <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
                <div class="upload-container">
                    <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                    <label class="upload-label">CHOOSE FILE</label>
                    <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
                </div>
                <div class="upload-submit">
                    <button type="submit" class="form-btn">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <!-- Place after the RTA form -->
     <div class="form-card" id="rta-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
            <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
            <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="rta-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: RTA AGREEMENT
        </div>
        
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL RTA AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="rta-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE RTA AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="rta-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE RTA AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="rta-incomplete-count">0</span>
                </span>
            </div>
        </div>
        
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    id="rta-search-input"
                    type="text"
                    placeholder="SEARCH BY LOCATION, CONTRACTOR"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span id="rta-search-icon" style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="rta-search-result"></div>
        </div>
    </div>
</div>
    <div class="form-card" id="mpp_sahayak-form">
        <!-- Place this inside each .form-card, after the <form> -->
<div class="form-success-message" style="display:none;">
  <svg class="tick-animate" width="60" height="60" viewBox="0 0 60 60" style="margin-bottom:18px; display:block;">
    <circle cx="30" cy="30" r="28" fill="none" stroke="#27ae60" stroke-width="4" opacity="0.15"/>
    <polyline points="18,32 27,41 43,23" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
</div>
    <div class="form-title">MPP/Sahayak Agreement Entry Form</div>
    <form>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">MCC</label>
                <input class="form-input" type="text" name="mcc">
            </div>
            <div class="form-group">
                <label class="form-label">MPP Code</label>
                <input class="form-input" type="text" name="mpp_code">
            </div>
            <div class="form-group">
                <label class="form-label">MPP Name</label>
                <input class="form-input" type="text" name="mpp_name">
            </div>
            <div class="form-group">
                <label class="form-label">Sahayak Name</label>
                <input class="form-input" type="text" name="sahayak_name">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Father's Name</label>
                <input class="form-input" type="text" name="father_name">
            </div>
            <div class="form-group">
                <label class="form-label">Address</label>
                <input class="form-input" type="text" name="address">
            </div>
            <div class="form-group">
                <label class="form-label">Mobile Number</label>
                <input class="form-input" type="text" name="mobile_number">
            </div>
            <div class="form-group">
                <label class="form-label">Aadhar</label>
                <input class="form-input" type="text" name="aadhar">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">PAN</label>
                <input class="form-input" type="text" name="pan">
            </div>
            <div class="form-group">
                <label class="form-label">Account Number</label>
                <input class="form-input" type="text" name="account_number">
            </div>
            <div class="form-group">
                <label class="form-label">IFSC Code</label>
                <input class="form-input" type="text" name="ifsc_code">
            </div>
            <div class="form-group">
                    <label class="form-label">DOCUMENT STATUS</label>
                        <select class="form-input" name="document_status" required>
                            <option value="" disabled selected>Select Status</option>
                            <option value="INCOMPLETE">INCOMPLETE</option>
                            <option value="COMPLETE">COMPLETE</option>
                        </select>
                </div>
                <div class="form-group">
                    <label class="form-label">NAME A PENDING DOCUMENT</label>
                    <input class="form-input" type="text" name="document_pending">
                </div>
        </div>
        <div class="upload-section">
            <div class="upload-title">UPLOAD SCANNED DOCUMENT</div>
            <div class="upload-container">
                <input type="file" class="file-input" name="document" accept=".pdf,.jpg,.jpeg,.png">
                <label class="upload-label">CHOOSE FILE</label>
                <div class="upload-instructions">ONLY UPLOAD THE MERGED PDF PLEASE</div>
            </div>
            <div class="upload-submit">
                <button type="submit" class="form-btn">Submit</button>
            </div>
        </div>
    </form>
</div>
    <!-- Place after the RTA form -->
     <div class="form-card" id="mpp_sahayak-edit-card" style="display:none;">
    <div class="form-success-message" style="display:none;">
        <!-- ...success SVG... -->
        <div style="font-size:1.3rem; color:#096B68; font-weight:600;">SUBMIT SUCCESSFULLY</div>
    </div>
    <div style="padding-top:15px; padding-bottom:32px;">
        <!-- Title -->
        <div id="amc-edit-title" style="font-size:1.1rem; font-weight:600; color:#ffffff; text-align:center;">
            EDITING: MPP/SAHAYAK AGREEMENT
        </div>
        <!-- Stats Row -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
            <div style="display: flex; align-items: center; gap: 7px; padding-left: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    TOTAL MPP AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#F79B72;">
                    <span style="color:#FFFA8D; font-size:1.05rem; font-weight:700;" id="mpp_sahayak-total-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    COMPLETE MPP AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#A0C878">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="mpp_sahayak-complete-count">0</span>
                </span>
            </div>
            <div style="display: flex; align-items: center; gap: 7px; padding-right: 10px;">
                <span style="font-size:0.95rem; color:#EFE4D2; font-weight:600; letter-spacing:0.5px;">
                    INCOMPLETE MPP AGREEMENT
                </span>
                <span style="display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:50%; background:#FF6363">
                    <span style="color:#FFFDF6; font-size:1.05rem; font-weight:700;" id="mpp_shaayak-incomplete-count">0</span>
                </span>
            </div>
        </div>
        <!-- Search Box -->
        <div style="padding: 15px 20px 0 20px; margin-bottom: 10px; margin-top: 20px;">
            <div style="position: relative; width: 100%;">
                <input
                    type="text"
                    placeholder="SEARCH BY LOCATION"
                    style="width: 100%; background: #FFEDDB; border: none; border-radius: 24px; padding: 12px 44px 12px 18px; font-size: 1rem; color: #000; outline: none; box-sizing: border-box; font-weight: 500;"
                />
                <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) rotate(-20deg); color: #2C2C2C; font-size: 1.2rem; pointer-events: none;">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <div id="mpp_sahayak-search-result"></div>
        </div>
    </div>
</div>
<div class="form-card active" id="view-form" style="background: rgb(229, 178, 153); display: block; height: 436px; border-right-width: 0px; margin-right: 21px;">
    <!-- INCOMPLETE AGREEMENTS CARD -->
    <div id="incomplete-card" class="expandable-card" style="background: #5A827E; padding: 10px; border-radius: 14px; width: 100%; margin-bottom: 18px; box-sizing: border-box;">
        <div class="expandable-header" style="display: flex; align-items: center; cursor: pointer;">
            <span id="incomplete-toggle" style="margin-right: 18px; margin-top: 2px; color: #fff; font-size: 1.3rem; transition: transform 0.2s;">
                <i class="fas fa-chevron-down"></i>
            </span>
            <div style="flex: 1;">
                <div style="font-size: 1.15rem; font-weight: 600; color: #fff;">
                    INCOMPLETE AGREEMENTS:
                </div>
            </div>
        </div>
        <div class="expandable-content" id="incomplete-content" style="display: none; padding: 18px 0 0 36px;">
            <div style="color: #fff; font-size: 1.1rem; margin-bottom: 32px;">
                THERE ARE TOTAL <span style="
        display: inline-block;
        min-width: 38px;
        padding: 6px 18px;
        border-radius: 16px;
        background: #F79B72;
        color: #fff;
        font-weight: bold;
        font-size: 1.1rem;
        text-align: center;
        margin: 0 8px;
    ">{{total_incomplete}}</span> INCOMPLETE AGREEMENTS
            </div>
            <div style="display: flex; justify-content: center; align-items: flex-end; height: 80px;">
                <!-- Replace the button inside the incomplete agreements card with: -->
            <button id="download-incomplete-btn"
                onclick="window.location.href='{% url 'download_incomplete_excel' %}'"
                style="display: inline-block; background: #F2C078; color: #333; border: none; border-radius: 8px; padding: 12px 32px; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
                Download Excel Report
            </button>
            </div>
        </div>
    </div>
    <!-- COMPLETE AGREEMENTS CARD -->
    <div id="complete-card" class="expandable-card" style="background: #5A827E; padding: 10px; border-radius: 14px; width: 100%; margin-bottom: 18px; box-sizing: border-box;">
    <div class="expandable-header" style="display: flex; align-items: center; cursor: pointer;">
        <span id="complete-toggle" style="margin-right: 18px; margin-top: 2px; color: #fff; font-size: 1.3rem; transition: transform 0.2s;">
            <i class="fas fa-chevron-down"></i>
        </span>
        <div style="flex: 1;">
            <div style="font-size: 1.15rem; font-weight: 600; color: #fff;">
                COMPLETE AGREEMENTS:
            </div>
        </div>
    </div>
    <div class="expandable-content" id="complete-content" style="display: none; padding: 18px 0 0 36px;">
        <div style="color: #fff; font-size: 1.1rem; margin-bottom: 32px;">
            THERE ARE TOTAL <span style="
        display: inline-block;
        min-width: 38px;
        padding: 6px 18px;
        border-radius: 16px;
        background: #9EBC8A;
        color: #fff;
        font-weight: bold;
        font-size: 1.1rem;
        text-align: center;
        margin: 0 8px;
    ">{{total_complete}}</span> COMPLETE AGREEMENTS
        </div>
        <!-- Download button removed here -->
    </div>
</div>
</div>

</div>
</div>
</div>


<!-- PDF Viewer Modal -->
<div class="pdf-viewer-modal" id="pdfViewerModal">
    <div class="pdf-viewer-container">
        <div class="pdf-viewer-header">
            <h2 class="pdf-viewer-title">PDF Viewer</h2>
            <button class="pdf-viewer-close" id="pdfViewerClose">&times;</button>
        </div>
        <div class="pdf-viewer-content" id="pdfViewerContent">
            <!-- PDF pages will be rendered here -->
        </div>
        <div class="pdf-navigation">
            <button class="pdf-nav-button" id="pdfPrevPage">Previous</button>
            <span id="pdfPageInfo">Page 1 of 1</span>
            <button class="pdf-nav-button" id="pdfNextPage">Next</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Helper to get CSRF token from cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

    function openPdfInModal(pdfUrl) {
    // Fetch the PDF as a blob and open in your modal
    fetch(pdfUrl)
        .then(response => response.blob())
        .then(blob => {
            const fileReader = new FileReader();
            fileReader.onload = function() {
                const typedArray = new Uint8Array(this.result);
                document.getElementById('pdfViewerModal').style.display = 'flex';
                document.getElementById('pdfViewerContent').innerHTML = '<div style="color:#096B68;font-size:1.2rem;margin:40px;">Loading PDF...</div>';
                document.getElementById('pdfPageInfo').textContent = '';
                document.getElementById('pdfPrevPage').disabled = true;
                document.getElementById('pdfNextPage').disabled = true;
                renderPdf(typedArray);
            };
            fileReader.readAsArrayBuffer(blob);
        })
        .catch(() => {
            alert('Could not load PDF for preview.');
        });
}

// --- MILK SALE AGREEMENT SEARCH/EDIT ---
let milkSaleSearchInput, milkSaleSearchIcon, milkSaleSearchResult;

function parseMilkSaleSearchInput(input) {
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    return { location, contractor };
}

function searchMilkSaleAgreement() {
    const input = milkSaleSearchInput.value.trim();
    const { location, contractor } = parseMilkSaleSearchInput(input);
    
    if (!location || !contractor) {
        milkSaleSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and contractor, separated by a comma.</div>';
        return;
    }
    
    fetch(`/milk_sale/search/?location=${encodeURIComponent(location)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => res.json())
        .then(data => renderMilkSaleResultCard(data.results))
        .catch(() => {
            milkSaleSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderMilkSaleResultCard(data) {
    if (!data || data.length === 0) {
        milkSaleSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/contractor)</div>';
        return;
    }
    
    const obj = data[0];
    window.currentMilkSaleId = obj.id;
    
    milkSaleSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="milk-sale-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="milk-sale-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="milk-sale-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="milk-sale-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="milkSaleInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="milkSaleInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="milkSaleInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="milk-sale-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        // PDF preview logic
        const editIcon = document.getElementById('milk-sale-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('milk-sale-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('milkSaleInsertPdfInput');
        const insertFilename = document.getElementById('milkSaleInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('milk-sale-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('milk-sale-edit-doc-status');
                const milkSaleId = window.currentMilkSaleId;
                const missingDocInput = document.getElementById('milk-sale-edit-missing-document');
                
                if (!milkSaleId) {
                    alert('Milk Sale Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/milk_sale/edit-merge/${milkSaleId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const editCard = document.getElementById('milk_sale-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            milkSaleSearchResult.innerHTML = '';
                            updateAgreementStats('milk_sale');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Initialize milk sale search functionality
document.addEventListener('DOMContentLoaded', function() {
    milkSaleSearchInput = document.getElementById('milk_sale-search-input');
    milkSaleSearchIcon = document.getElementById('milk_sale-search-icon');
    milkSaleSearchResult = document.getElementById('milk_sale-search-result');
    
    if(milkSaleSearchInput && milkSaleSearchIcon) {
        milkSaleSearchInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                e.preventDefault();
                searchMilkSaleAgreement();
            }
        });
        
        milkSaleSearchIcon.addEventListener('click', function() {
            searchMilkSaleAgreement();
        });
    }
});

function updateAgreementStats(type) {
    if (type === 'milk_sale') {
        fetch('/milk_sale/stats/')
            .then(res => res.json())
            .then(data => {
                document.getElementById('milk_sale-total-count').textContent = data.total;
                document.getElementById('milk_sale-complete-count').textContent = data.complete;
                document.getElementById('milk_sale-incomplete-count').textContent = data.incomplete;
            });
    }
}

// --- GODOWN AGREEMENT SEARCH/EDIT ---
let godownSearchInput, godownSearchIcon, godownSearchResult;

function parseGodownSearchInput(input) {
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    return { location, contractor };
}

function searchGodownAgreement() {
    const input = godownSearchInput.value.trim();
    const { location, contractor } = parseGodownSearchInput(input);
    
    if (!location || !contractor) {
        godownSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and contractor, separated by a comma.</div>';
        return;
    }
    
    fetch(`/godown/search/?location=${encodeURIComponent(location)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => res.json())
        .then(data => renderGodownResultCard(data.results))
        .catch(() => {
            godownSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderGodownResultCard(data) {
    if (!data || data.length === 0) {
        godownSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/contractor)</div>';
        return;
    }
    
    const obj = data[0];
    window.currentGodownId = obj.id;
    
    godownSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="godown-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="godown-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="godown-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="godown-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="godownInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="godownInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="godownInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="godown-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        // PDF preview logic
        const editIcon = document.getElementById('godown-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('godown-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('godownInsertPdfInput');
        const insertFilename = document.getElementById('godownInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('godown-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('godown-edit-doc-status');
                const godownId = window.currentGodownId;
                const missingDocInput = document.getElementById('godown-edit-missing-document');
                
                if (!godownId) {
                    alert('Godown Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/godown/edit-merge/${godownId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const editCard = document.getElementById('godown-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            godownSearchResult.innerHTML = '';
                            updateAgreementStats('godown');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Initialize Godown search functionality
document.addEventListener('DOMContentLoaded', function() {
    godownSearchInput = document.getElementById('godown-search-input');
    godownSearchIcon = document.getElementById('godown-search-icon');
    godownSearchResult = document.getElementById('godown-search-result');
    
    if(godownSearchInput && godownSearchIcon) {
        godownSearchInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                e.preventDefault();
                searchGodownAgreement();
            }
        });
        
        godownSearchIcon.addEventListener('click', function() {
            searchGodownAgreement();
        });
    }
});
// ----RTA AGREEMENT SEARCH/EDIT------
let rtaSearchInput, rtaSearchIcon, rtaSearchResult;

function parseRtaSearchInput(input) {
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    return { location, contractor };
}

function searchRtaAgreement() {
    const input = rtaSearchInput.value.trim();
    const { location, contractor } = parseRtaSearchInput(input);
    
    if (!location || !contractor) {
        rtaSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and contractor, separated by a comma.</div>';
        return;
    }
    
    fetch(`/rta/search/?location=${encodeURIComponent(location)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => res.json())
        .then(data => renderRtaResultCard(data.results))
        .catch(() => {
            rtaSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderRtaResultCard(data) {
    if (!data || data.length === 0) {
        rtaSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/contractor)</div>';
        return;
    }
    
    const obj = data[0];
    window.currentRtaId = obj.id;
    
    rtaSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="rta-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="rta-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="rta-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="rta-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="rtaInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="rtaInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="rtaInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="rta-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        // PDF preview logic
        const editIcon = document.getElementById('rta-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('rta-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('rtaInsertPdfInput');
        const insertFilename = document.getElementById('rtaInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('rta-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('rta-edit-doc-status');
                const rtaId = window.currentRtaId;
                const missingDocInput = document.getElementById('rta-edit-missing-document');
                
                if (!rtaId) {
                    alert('RTA Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/rta/edit-merge/${rtaId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const editCard = document.getElementById('rta-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            rtaSearchResult.innerHTML = '';
                            updateAgreementStats('rta');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Initialize RTA search functionality
document.addEventListener('DOMContentLoaded', function() {
    rtaSearchInput = document.getElementById('rta-search-input');
    rtaSearchIcon = document.getElementById('rta-search-icon');
    rtaSearchResult = document.getElementById('rta-search-result');
    
    if(rtaSearchInput && rtaSearchIcon) {
        rtaSearchInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                e.preventDefault();
                searchRtaAgreement();
            }
        });
        
        rtaSearchIcon.addEventListener('click', function() {
            searchRtaAgreement();
        });
    }
});


// ----MPACS AGREEMENT SEARCH/EDIT-----
let mpacsSearchInput, mpacsSearchIcon, mpacsSearchResult;

function parseMpacsSearchInput(input) {
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    return { location, contractor };
}

function searchMpacsAgreement() {
    const input = mpacsSearchInput.value.trim();
    const { location, contractor } = parseMpacsSearchInput(input);
    
    if (!location || !contractor) {
        mpacsSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and contractor, separated by a comma.</div>';
        return;
    }
    
    fetch(`/mpacs/search/?location=${encodeURIComponent(location)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => res.json())
        .then(data => renderMpacsResultCard(data.results))
        .catch(() => {
            mpacsSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderMpacsResultCard(data) {
    if (!data || data.length === 0) {
        mpacsSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/contractor)</div>';
        return;
    }
    
    const obj = data[0];
    window.currentMpacsId = obj.id;
    
    mpacsSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="mpacs-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="mpacs-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="mpacs-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="mpacs-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="mpacsInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="mpacsInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="mpacsInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="mpacs-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        // PDF preview logic
        const editIcon = document.getElementById('mpacs-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('mpacs-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('mpacsInsertPdfInput');
        const insertFilename = document.getElementById('mpacsInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('mpacs-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('mpacs-edit-doc-status');
                const mpacsId = window.currentMpacsId;
                const missingDocInput = document.getElementById('mpacs-edit-missing-document');
                
                if (!mpacsId) {
                    alert('MPACS Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/mpacs/edit-merge/${mpacsId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const editCard = document.getElementById('mpacs-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            mpacsSearchResult.innerHTML = '';
                            updateAgreementStats('mpacs');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Initialize MPACS search functionality
document.addEventListener('DOMContentLoaded', function() {
    mpacsSearchInput = document.getElementById('mpacs-search-input');
    mpacsSearchIcon = document.getElementById('mpacs-search-icon');
    mpacsSearchResult = document.getElementById('mpacs-search-result');
    
    if(mpacsSearchInput && mpacsSearchIcon) {
        mpacsSearchInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                e.preventDefault();
                searchMpacsAgreement();
            }
        });
        
        mpacsSearchIcon.addEventListener('click', function() {
            searchMpacsAgreement();
        });
    }
});

// --- MCC AGREEMENT SEARCH/EDIT ---
let mccSearchInput, mccSearchIcon, mccSearchResult;

function parseMccSearchInput(input) {
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    return { location, contractor };
}

function searchMccAgreement() {
    const input = mccSearchInput.value.trim();
    const { location, contractor } = parseMccSearchInput(input);
    
    if (!location || !contractor) {
        mccSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and contractor, separated by a comma.</div>';
        return;
    }
    
    fetch(`/mcc/search/?location=${encodeURIComponent(location)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => res.json())
        .then(data => renderMccResultCard(data.results))
        .catch(() => {
            mccSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderMccResultCard(data) {
    if (!data || data.length === 0) {
        mccSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/contractor)</div>';
        return;
    }
    
    const obj = data[0];
    window.currentMccId = obj.id;
    
    mccSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="mcc-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="mcc-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="mcc-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="mcc-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="mccInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="mccInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="mccInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="mcc-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        // PDF preview logic
        const editIcon = document.getElementById('mcc-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('mcc-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('mccInsertPdfInput');
        const insertFilename = document.getElementById('mccInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('mcc-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('mcc-edit-doc-status');
                const mccId = window.currentMccId;
                const missingDocInput = document.getElementById('mcc-edit-missing-document');
                
                if (!mccId) {
                    alert('MCC Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/mcc/edit-merge/${mccId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        const editCard = document.getElementById('mcc-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            mccSearchResult.innerHTML = '';
                            updateAgreementStats('mcc');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Initialize MCC search functionality
document.addEventListener('DOMContentLoaded', function() {
    mccSearchInput = document.getElementById('mcc-search-input');
    mccSearchIcon = document.getElementById('mcc-search-icon');
    mccSearchResult = document.getElementById('mcc-search-result');
    
    if(mccSearchInput && mccSearchIcon) {
        mccSearchInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                e.preventDefault();
                searchMccAgreement();
            }
        });
        
        mccSearchIcon.addEventListener('click', function() {
            searchMccAgreement();
        });
    }
});

//DISTRIBUTER AGREEMENT EDIT AND SEARCH
let distributerSearchInput, distributerSearchIcon, distributerSearchResult;

function parseDistributerSearchInput(input) {
    console.log('Parsing input:', input); // Log the raw input
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    console.log('Parsed result:', { location, contractor }); // Log the parsed result
    return { location, contractor };
}

function searchDistributerAgreement() {
    const input = distributerSearchInput.value.trim();
    console.log('Search initiated with input:', input); // Log the search input
    
    const { location, contractor } = parseDistributerSearchInput(input);
    
    if (!location || !contractor) {
        console.log('Validation failed - missing location or contractor');
        distributerSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and contractor, separated by a comma.</div>';
        return;
    }
    
    console.log('Making API request with:', { location, contractor }); // Log before API call
    fetch(`/distributer/search/?location=${encodeURIComponent(location)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => {
            console.log('API response status:', res.status); // Log response status
            return res.json();
        })
        .then(data => {
            console.log('API response data:', data); // Log full API response
            renderDistributerResultCard(data.results);
        })
        .catch((err) => {
            console.error('API error:', err); // Log any errors
            distributerSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderDistributerResultCard(data) {
    console.log('Rendering result card with data:', data); // Log the data being rendered
    
    if (!data || data.length === 0) {
        console.log('No results found');
        distributerSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/contractor)</div>';
        return;
    }
    
    const obj = data[0];
    console.log('Rendering object:', obj); // Log the specific object being rendered
    window.currentDistributerId = obj.id;
    console.log('Set currentDistributerId:', window.currentDistributerId); // Log the ID
    
    distributerSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="distributer-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="distributer-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="distributer-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="distributer-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="distributerInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="distributerInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="distributerInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="distributer-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        console.log('Setting up event listeners for the rendered card');
        
        // PDF preview logic
        const editIcon = document.getElementById('distributer-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('distributer-doc-link');
                console.log('Edit icon clicked, docLink:', docLink);
                if(docLink && docLink.href) {
                    console.log('Opening PDF:', docLink.href);
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('distributerInsertPdfInput');
        const insertFilename = document.getElementById('distributerInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                console.log('File input changed');
                const file = e.target.files[0];
                console.log('Selected file:', file);
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                    console.log('PDF file accepted:', file.name);
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    console.log('Invalid file selected');
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('distributer-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                console.log('Submit button clicked');
                const statusSelect = document.getElementById('distributer-edit-doc-status');
                const distributerId = window.currentDistributerId;
                const missingDocInput = document.getElementById('distributer-edit-missing-document');
                
                console.log('Submit data:', {
                    distributerId,
                    document_status: statusSelect.value,
                    missing_document: missingDocInput ? missingDocInput.value : '',
                    pdf_file: insertedPdfFile ? insertedPdfFile.name : 'none'
                });
                
                if (!distributerId) {
                    console.error('Distributor Agreement ID not found');
                    alert('Distributor Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    console.error('No PDF file selected');
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                console.log('Submitting form data');
                fetch(`/distributer/edit-merge/${distributerId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => {
                    console.log('Edit API response status:', res.status);
                    return res.json();
                })
                .then(data => {
                    console.log('Edit API response data:', data);
                    if (data.success) {
                        console.log('Edit successful');
                        const editCard = document.getElementById('distributer-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            distributerSearchResult.innerHTML = '';
                            updateAgreementStats('distributer');
                        }, 2000);
                    } else {
                        console.error('Edit failed:', data.error || 'Unknown error');
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    console.error('Edit request failed:', err);
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Initialize distributor search functionality
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOMContentLoaded - initializing distributor search');
    distributerSearchInput = document.getElementById('distributer-search-input');
    distributerSearchIcon = document.getElementById('distributer-search-icon');
    distributerSearchResult = document.getElementById('distributer-search-result');
    
    console.log('Elements found:', {
        input: distributerSearchInput,
        icon: distributerSearchIcon,
        result: distributerSearchResult
    });
    
    if(distributerSearchInput && distributerSearchIcon) {
        distributerSearchInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                console.log('Enter key pressed in search input');
                e.preventDefault();
                searchDistributerAgreement();
            }
        });
        
        distributerSearchIcon.addEventListener('click', function() {
            console.log('Search icon clicked');
            searchDistributerAgreement();
        });
    }
});

// --- COOK AGREEMENT SEARCH/EDIT ---

let cookSearchInput, cookSearchIcon, cookSearchResult;

function parseCookSearchInput(input) {
    console.log('[parseCookSearchInput] Input received:', input);
    const parts = input.split(',');
    const location = parts[0] ? parts[0].trim() : '';
    const cookName = parts[1] ? parts[1].trim() : '';
    console.log('[parseCookSearchInput] Parsed values - location:', location, 'cookName:', cookName);
    return { location, cookName };
}

function searchCookAgreement() {
    console.log('[searchCookAgreement] Function called');
    const input = cookSearchInput.value.trim();
    console.log('[searchCookAgreement] Raw input:', input);
    
    const { location, cookName } = parseCookSearchInput(input);
    console.log('[searchCookAgreement] Parsed input - location:', location, 'cookName:', cookName);
    
    if (!location || !cookName) {
        console.warn('[searchCookAgreement] Validation failed - missing location or cook name');
        cookSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both location and cook name, separated by a comma.</div>';
        return;
    }

    const url = `/cook/search/?location=${encodeURIComponent(location)}&cook_name=${encodeURIComponent(cookName)}`;
    console.log('[searchCookAgreement] Fetching from URL:', url);
    
    fetch(url)
        .then(res => {
            console.log('[searchCookAgreement] Fetch response received, status:', res.status);
            return res.json();
        })
        .then(data => {
            console.log('[searchCookAgreement] JSON data received:', data);
            renderCookResultCard(data.results);
        })
        .catch((error) => {
            console.error('[searchCookAgreement] Error fetching data:', error);
            cookSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderCookResultCard(data) {
    console.log('[renderCookResultCard] Data received:', data);
    
    if (!data || data.length === 0) {
        console.warn('[renderCookResultCard] No data or empty array received');
        cookSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location/cook name)</div>';
        return;
    }

    const obj = data[0];
    console.log('[renderCookResultCard] First result object:', obj);
    
    window.currentCookId = obj.id;
    console.log('[renderCookResultCard] Stored currentCookId:', window.currentCookId);

    console.log('[renderCookResultCard] Rendering HTML template...');
    cookSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">LOCATION</div>
                <div style="flex:1;">COOK NAME</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.location}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="cook-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="cook-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="cook-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="cook-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="cookInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="cookInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="cookInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="cook-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;

    console.log('[renderCookResultCard] Setting up event listeners...');
    setTimeout(() => {
        // PDF preview logic
        const editIcon = document.getElementById('cook-doc-edit');
        if (editIcon) {
            console.log('[renderCookResultCard] Found PDF edit icon, setting up click handler');
            editIcon.addEventListener('click', function() {
                const docLink = document.getElementById('cook-doc-link');
                console.log('[editIcon click] PDF link:', docLink?.href);
                if (docLink && docLink.href) {
                    console.log('[editIcon click] Opening PDF in modal');
                    openPdfInModal(docLink.href);
                }
            });
        }

        // File selection logic
        const insertInput = document.getElementById('cookInsertPdfInput');
        const insertFilename = document.getElementById('cookInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            console.log('[renderCookResultCard] Found PDF input, setting up change handler');
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                console.log('[insertInput change] File selected:', file);
                
                if (file && file.type === 'application/pdf') {
                    console.log('[insertInput change] Valid PDF file selected');
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    console.warn('[insertInput change] Invalid file type selected');
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('cook-edit-submit');
        if (submitBtn) {
            console.log('[renderCookResultCard] Found submit button, setting up click handler');
            submitBtn.addEventListener('click', function() {
                console.log('[submitBtn click] Submit button clicked');
                
                const statusSelect = document.getElementById('cook-edit-doc-status');
                const cookId = window.currentCookId;
                const missingDocInput = document.getElementById('cook-edit-missing-document');
                
                console.log('[submitBtn click] Current values - status:', statusSelect.value, 
                          'cookId:', cookId, 
                          'missingDoc:', missingDocInput?.value,
                          'pdfFile:', insertedPdfFile?.name);

                if (!cookId) {
                    console.error('[submitBtn click] No cookId found');
                    alert('Cook Agreement ID not found.');
                    return;
                }
                
                if (!insertedPdfFile) {
                    console.warn('[submitBtn click] No PDF file selected');
                    alert('Please select a PDF to insert.');
                    return;
                }

                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');
                
                console.log('[submitBtn click] FormData prepared, sending request...');
                
                fetch(`/cook/edit-merge/${cookId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => {
                    console.log('[submitBtn click] Response received, status:', res.status);
                    return res.json();
                })
                .then(data => {
                    console.log('[submitBtn click] JSON response:', data);
                    if (data.success) {
                        console.log('[submitBtn click] Update successful');
                        const editCard = document.getElementById('cook-edit-card');
                        const successMsg = editCard?.querySelector('.form-success-message');
                        
                        if (successMsg) {
                            console.log('[submitBtn click] Showing success message');
                            successMsg.style.display = 'flex';
                        }
                        
                        if (editCard) {
                            editCard.classList.add('success-active');
                        }
                        
                        setTimeout(() => {
                            console.log('[submitBtn click] Resetting UI after success');
                            if (successMsg) successMsg.style.display = 'none';
                            if (editCard) editCard.classList.remove('success-active');
                            if (editCard) editCard.style.display = 'none';
                            cookSearchResult.innerHTML = '';
                            updateAgreementStats('cook');
                        }, 2000);
                    } else {
                        console.error('[submitBtn click] Update failed:', data.error);
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    console.error('[submitBtn click] Fetch error:', err);
                    alert('Error: ' + err.message);
                });
            });
        }
    }, 0);
}

// Attach event listeners after DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('[DOMContentLoaded] Initializing cook agreement search...');
    
    cookSearchInput = document.getElementById('cook-search-input');
    cookSearchIcon = document.getElementById('cook-search-icon');
    cookSearchResult = document.getElementById('cook-search-result');
    
    console.log('[DOMContentLoaded] Elements found - input:', cookSearchInput, 'icon:', cookSearchIcon, 'result:', cookSearchResult);
    
    if (cookSearchInput && cookSearchIcon) {
        console.log('[DOMContentLoaded] Setting up event listeners for search');
        
        cookSearchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                console.log('[cookSearchInput] Enter key pressed');
                e.preventDefault();
                searchCookAgreement();
            }
        });
        
        cookSearchIcon.addEventListener('click', function() {
            console.log('[cookSearchIcon] Search icon clicked');
            searchCookAgreement();
        });
    } else {
        console.error('[DOMContentLoaded] Required elements not found');
    }
});

console.log('Cook agreement module loaded');

// --- CONSULTANT AGREEMENT SEARCH/EDIT ---

function parseConsultantSearchInput(input) {
    const parts = input.split(',');
    const category = parts[0] ? parts[0].trim() : '';
    const contractor = parts[1] ? parts[1].trim() : '';
    return { category, contractor };
}

function searchConsultantAgreement() {
    const input = consultantSearchInput.value.trim();
    const { category, contractor } = parseConsultantSearchInput(input);
    if (!category || !contractor) {
        consultantSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both category and contractor, separated by a comma.</div>';
        return;
    }
    fetch(`/consultant/search/?category=${encodeURIComponent(category)}&contractor=${encodeURIComponent(contractor)}`)
        .then(res => res.json())
        .then(data => renderConsultantResultCard(data.results))
        .catch(() => {
            consultantSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderConsultantResultCard(data) {
    if (!data || data.length === 0) {
        consultantSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong category/contractor)</div>';
        return;
    }
    const obj = data[0];
    window.currentConsultantId = obj.id;
    consultantSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">CATEGORY</div>
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.category}</div>
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">
                    <select id="consultant-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                        // Here we will have the EXPIRE OR CLOSED OPTION.
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="consultant-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="consultant-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="consultant-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="consultantInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="consultantInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="consultantInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                        `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="consultant-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    setTimeout(()=> {
        // PDF preview logic
        const editIcon = document.getElementById('consultant-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('consultant-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href)
                }
            })
        }
        // File selection logic
        const insertInput = document.getElementById('consultantInsertPdfInput');
        const insertFilename = document.getElementById('consultantInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('consultant-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('consultant-edit-doc-status');
                const consultantId = window.currentConsultantId;
                if (!consultantId) {
                    alert('Consultant Agreement ID not found.');
                    return;
                }
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }
                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                const missingDocInput = document.getElementById('consultant-edit-missing-document');
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/consultant/edit-merge/${consultantId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        // Show success message and reset UI
                        const editCard = document.getElementById('consultant-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            consultantSearchResult.innerHTML = '';
                            updateAgreementStats('consultant');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    });
}

// Attach event listeners after DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    consultantSearchInput = document.getElementById('consultant-search-input');
    consultantSearchIcon = document.getElementById('consultant-search-icon');
    consultantSearchResult = document.getElementById('consultant-search-result');
    if(consultantSearchInput && consultantSearchIcon){
        consultantSearchInput.addEventListener('keydown', function(e){
            if(e.key === 'Enter'){
                e.preventDefault();
                searchConsultantAgreement();
            }
        });
        consultantSearchIcon.addEventListener('click', function() {
            searchConsultantAgreement();
        });
    }
});
// Function for parsing the input services.
function parseInputServicesSearchInput(input){
    console.log("The input is",input)
    const parts = input.split(',');
    console.log("The Parts are", parts)
    const contractor = parts[0] ? parts[0].trim() : '';
    console.log("The contractor are", contractor)
    const product = parts[1] ? parts[1].trim() : '';
    console.log("The product is", product)
    return {contractor, product};
}

function searchInputServicesAgreement() {
    const input = inputServicesSearchInput.value.trim();
    const { contractor, product } = parseInputServicesSearchInput(input);
    if (!contractor || !product) {
        inputServicesSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both contractor and product, separated by a comma.</div>';
        return;
    }
    fetch(`/input_services/search/?contractor=${encodeURIComponent(contractor)}&product=${encodeURIComponent(product)}`)
        .then(res => res.json())
        .then(data => renderInputServicesResultCard(data.results))
        .catch(() => {
            inputServicesSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

// ...existing code...
function renderInputServicesResultCard(data) {
    if (!data || data.length === 0) {
        inputServicesSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong contractor/product)</div>';
        return;
    }
    const obj = data[0];
    window.currentInputServicesId = obj.id;
    inputServicesSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">PRODUCT</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${obj.contractor}</div>
                <div style="flex:1;">${obj.product}</div>
                <div style="flex:1;">
                    <select id="input_services-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${obj.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${obj.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="input_services-edit-missing-document" type="text" value="${obj.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        obj.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${obj.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="input_services-doc-link">${obj.document_name}</a>
                                <span style="cursor:pointer;" id="input_services-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="inputServicesInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="inputServicesInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="inputServicesInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                           `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="input_services-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    setTimeout(()=> {
        // PDF preview logic
        const editIcon = document.getElementById('input_services-doc-edit');
        if(editIcon) {
            editIcon.addEventListener('click', function(){
                const docLink = document.getElementById('input_services-doc-link');
                if(docLink && docLink.href) {
                    openPdfInModal(docLink.href)
                }
            })
        }

        // File selection logic
        const insertInput = document.getElementById('inputServicesInsertPdfInput');
        const insertFilename = document.getElementById('inputServicesInsertPdfFilename');
        let insertedPdfFile = null;

        if (insertInput) {
            insertInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    insertFilename.textContent = file.name;
                    insertedPdfFile = file;
                } else {
                    insertFilename.textContent = '';
                    insertedPdfFile = null;
                    alert('Please select a valid PDF file.');
                }
            });
        }

        // Submit button logic
        const submitBtn = document.getElementById('input_services-edit-submit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                const statusSelect = document.getElementById('input_services-edit-doc-status');
                const inputServicesId = window.currentInputServicesId;
                if (!inputServicesId) {
                    alert('Input Services ID not found.');
                    return;
                }
                if (!insertedPdfFile) {
                    alert('Please select a PDF to insert.');
                    return;
                }
                const formData = new FormData();
                formData.append('document_status', statusSelect.value);
                formData.append('insert_pdf', insertedPdfFile);
                const missingDocInput = document.getElementById('input_services-edit-missing-document');
                formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

                fetch(`/input_services/edit-merge/${inputServicesId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        // Show success message and reset UI
                        const editCard = document.getElementById('input_services-edit-card');
                        const successMsg = editCard.querySelector('.form-success-message');
                        if (successMsg) {
                            successMsg.style.display = 'flex';
                        }
                        editCard.classList.add('success-active');
                        setTimeout(() => {
                            if (successMsg) successMsg.style.display = 'none';
                            editCard.classList.remove('success-active');
                            editCard.style.display = 'none';
                            inputServicesSearchResult.innerHTML = '';
                            updateAgreementStats('input_services');
                        }, 2000);
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(err => {
                    alert('Error: ' + err.message);
                });
            });
        }
    });
}

// Attach event listeners after DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    inputServicesSearchInput = document.getElementById('input_services-search-input');
    inputServicesSearchIcon = document.getElementById('input_services-search-icon');
    inputServicesSearchResult = document.getElementById('input_services-search-result');
    if(inputServicesSearchInput && inputServicesSearchIcon){
        inputServicesSearchInput.addEventListener('keydown', function(e){
            if(e.key === 'Enter'){
                e.preventDefault();
                searchInputServicesAgreement();
            }
        });
        inputServicesSearchIcon.addEventListener('click', function() {
            searchInputServicesAgreement();
        });
    }
});
// FUNCTION FOR PARSING THE AMC EDIT CARD SEARCH INPUT 

function parseAmcSearchInput(input){
    const parts = input.split(',');
    console.log("The parts in the search input field is ", parts)
    const contractor = parts[0] ? parts[0].trim():'';
    console.log("The contractor is ", contractor)
    const product = parts[1] ? parts[1].trim():'';
    console.log("The product is", product)
    return {contractor, product}
}

// function for retrieving the data from the backend for amc search
function searchAmcAgreement() {
    const input = amcSearchInput.value.trim();
    const { contractor, product } = parseAmcSearchInput(input);
    if (!contractor || !product) {
        amcSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Please enter both contractor and product, separated by a comma.</div>';
        return;
    }
    fetch(`/amc/search/?contractor=${encodeURIComponent(contractor)}&product=${encodeURIComponent(product)}`)
        .then(res => res.json())
        .then(data => renderAmcResultCard(data.results))
        .catch(() => {
            amcSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
        });
}

function renderAmcResultCard(data) {
    if (!data || data.length === 0) {
        amcSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong contractor/product)</div>';
        return;
    }
    const amc = data[0];
    window.currentAmcId = amc.id;
    amcSearchResult.innerHTML = `
        <div style="background: #DEBA9D; border-radius: 18px; padding: 28px; margin: 18px 0 0 0; color: #2C2C2C; font-size: 1rem; box-shadow: 0 2px 12px rgba(0,0,0,0.10); width: 100%; box-sizing: border-box;">
            <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
                <div style="flex:1;">CONTRACTOR</div>
                <div style="flex:1;">PRODUCT</div>
                <div style="flex:1;">DOCUMENT STATUS</div>
                <div style="flex:1;">MISSING DOCUMENT</div>
            </div>
            <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
                <div style="flex:1;">${amc.contractor}</div>
                <div style="flex:1;">${amc.product}</div>
                <div style="flex:1;">
                    <select id="amc-edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
                        <option value="INCOMPLETE" ${amc.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
                        <option value="COMPLETE" ${amc.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <input id="amc-edit-missing-document" type="text" value="${amc.document_pending || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <div style="border: 2px dashed #b48b5a; border-radius: 16px; padding: 18px 32px; background: #D5CEA3; min-width: 220px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
                    ${
                        amc.document_url
                        ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <a href="${amc.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="amc-doc-link">${amc.document_name}</a>
                                <span style="cursor:pointer;" id="amc-doc-edit">
                                    <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                                </span>
                           </span>
                           <div style="margin-top:18px; padding-left:11px">
                                <label for="amcInsertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                                    UPLOAD PDF
                                    <input type="file" id="amcInsertPdfInput" accept="application/pdf" style="display:none;">
                                </label>
                                <span id="amcInsertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                            </div>
                           `
                        : `<span style="color:#b48b5a;">No document uploaded</span>`
                    }
                </div>
            </div>
            <div style="text-align:center; margin-top:24px;">
                <button id="amc-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
                    SUBMIT
                </button>
            </div>
        </div>
    `;
    setTimeout(()=> {
    const editIcon = document.getElementById('amc-doc-edit');
    if(editIcon) {
        editIcon.addEventListener('click', function(){
            const docLink = document.getElementById('amc-doc-link');
            if(docLink && docLink.href) {
                openPdfInModal(docLink.href)
            }
        })
    }
});
 
// 1. File selection logic
const insertInput = document.getElementById('amcInsertPdfInput');
const insertFilename = document.getElementById('amcInsertPdfFilename');
let insertedPdfFile = null;

if (insertInput) {
    insertInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && file.type === 'application/pdf') {
            insertFilename.textContent = file.name;
            insertedPdfFile = file;
        } else {
            insertFilename.textContent = '';
            insertedPdfFile = null;
            alert('Please select a valid PDF file.');
        }
    });
}

// 2. Submit button logic
const submitBtn = document.getElementById('amc-edit-submit');
if (submitBtn) {
    submitBtn.addEventListener('click', function() {
        const statusSelect = document.getElementById('amc-edit-doc-status');
        const amcId = window.currentAmcId;
        if (!amcId) {
            alert('AMC ID not found.');
            return;
        }
        if (!insertedPdfFile) {
            alert('Please select a PDF to insert.');
            return;
        }
        const formData = new FormData();
        formData.append('document_status', statusSelect.value);
        formData.append('insert_pdf', insertedPdfFile);
        const missingDocInput = document.getElementById('amc-edit-missing-document');
        formData.append('pending_document', missingDocInput ? missingDocInput.value : '');
        console.log('Submitting AMC edit merge:', {
    amcId,
    status: statusSelect.value,
    pending: missingDocInput ? missingDocInput.value : '',
    file: insertedPdfFile
});
        fetch(`/amc/edit-merge/${amcId}/`, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                // Show success message and reset UI
                const editCard = document.getElementById('amc-edit-card');
                const successMsg = editCard.querySelector('.form-success-message');
                if (successMsg) {
                    successMsg.style.display = 'flex';
                }
                editCard.classList.add('success-active');
                setTimeout(() => {
                    if (successMsg) successMsg.style.display = 'none';
                    editCard.classList.remove('success-active');
                    editCard.style.display = 'none';
                    amcSearchResult.innerHTML = '';
                    updateAgreementStats('amc');
                }, 2000);
            } else {
                alert('Error: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(err => {
            alert('Error: ' + err.message);
        });
    });
}
}

// INCOMPLETE & COMPLETE AGREEMENTS TOGGLE FUNCTIONALITY 
let amcSearchInput, amcSearchIcon, amcSearchResult;

document.addEventListener('DOMContentLoaded', function() {
    amcSearchInput = document.getElementById('amc-search-input');
    console.log("The amc search input is",amcSearchInput)
    amcSearchIcon = document.getElementById('amc-search-icon');
    console.log("The amc search icon is", amcSearchIcon)
    amcSearchResult = document.getElementById('amc-search-result');
    console.log("The amc search result is", amcSearchResult)
    //On Enter Key
    if(amcSearchInput && amcSearchIcon){
        amcSearchInput.addEventListener('keydown', function(e){
            if(e.key === 'Enter'){
                e.preventDefault();
                searchAmcAgreement();
            }
        });
    // On icon click
    amcSearchIcon.addEventListener('click', function() {
        searchAmcAgreement();
    });
    }
    function closeAllExpandable() {
        document.getElementById('incomplete-content').style.display = 'none';
        document.getElementById('complete-content').style.display = 'none';
        document.getElementById('incomplete-card').classList.remove('expanded');
        document.getElementById('complete-card').classList.remove('expanded');
        document.querySelector('#incomplete-toggle i').classList.remove('fa-chevron-up');
        document.querySelector('#incomplete-toggle i').classList.add('fa-chevron-down');
        document.querySelector('#complete-toggle i').classList.remove('fa-chevron-up');
        document.querySelector('#complete-toggle i').classList.add('fa-chevron-down');
    }

    // Attach to header instead of just icon
    document.querySelector('#incomplete-card .expandable-header').addEventListener('click', function() {
        var content = document.getElementById('incomplete-content');
        var card = document.getElementById('incomplete-card');
        var icon = document.querySelector('#incomplete-toggle i');
        if (content.style.display === 'none') {
            closeAllExpandable();
            content.style.display = 'block';
            card.classList.add('expanded');
            icon.classList.remove('fa-chevron-down');
            icon.classList.add('fa-chevron-up');
        } else {
            content.style.display = 'none';
            card.classList.remove('expanded');
            icon.classList.remove('fa-chevron-up');
            icon.classList.add('fa-chevron-down');
        }
    });

    document.querySelector('#complete-card .expandable-header').addEventListener('click', function() {
        var content = document.getElementById('complete-content');
        var card = document.getElementById('complete-card');
        var icon = document.querySelector('#complete-toggle i');
        if (content.style.display === 'none') {
            closeAllExpandable();
            content.style.display = 'block';
            card.classList.add('expanded');
            icon.classList.remove('fa-chevron-down');
            icon.classList.add('fa-chevron-up');
        } else {
            content.style.display = 'none';
            card.classList.remove('expanded');
            icon.classList.remove('fa-chevron-up');
            icon.classList.add('fa-chevron-down');
        }
    });
});
 
function updateAgreementStats(agreement) {
    console.log("The agreement is ", agreement)
    fetch(`/${agreement}/stats/`)
        .then(response => response.json())
        .then(data => {
            console.log(data)
            document.getElementById(`${agreement}-total-count`).textContent = data.total;
            document.getElementById(`${agreement}-complete-count`).textContent = data.complete;
            document.getElementById(`${agreement}-incomplete-count`).textContent = data.incomplete;
        })
        .catch(err => {
            console.error(`Failed to fetch ${agreement.toUpperCase()} stats:`, err);
        });
}

document.querySelectorAll('form[method="post"]').forEach(form => {
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        const formCard = form.closest('.form-card');
        const successMsg = formCard.querySelector('.form-success-message');

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .then(text => {
            if (text.trim() === "SUBMIT SUCCESSFULLY") {
                // Hide the form, show the success message, and remove green bg
                form.style.display = 'none';
                if (successMsg) {
                    successMsg.style.display = 'flex';
                }
                formCard.classList.add('success-active');
                // After 2s, hide the success message and show the form again
                setTimeout(() => {
                    if (successMsg) successMsg.style.display = 'none';
                    form.style.display = '';
                    form.reset();
                    formCard.classList.remove('success-active');
                    // Reset file input display
                    const uploadLabel = form.querySelector('.upload-label');
                    if (uploadLabel) uploadLabel.textContent = 'CHOOSE FILE';
                    const filenameDiv = form.querySelector('.upload-filename');
                    if (filenameDiv) filenameDiv.remove();
                }, 2000);
            } else {
                alert("Submission failed: " + text);
            }
        })
        .catch(err => {
            console.error('Error:', err);
            alert("Submission error: " + err.message);
        });
    });
});

function showSuccessMessage() {
    const msg = document.getElementById('successMessage');
    msg.style.display = 'flex';
    setTimeout(() => {
        msg.style.display = 'none';
    }, 2000);
}

// Show/hide forms logic
function showForm(formId) {
    // Hide all form cards (forms and edit cards)
    document.querySelectorAll('.form-card').forEach(f => {
        f.classList.remove('active');
        f.style.display = 'none';
    });

    // Hide selection prompts
    document.getElementById('selectionPrompt').style.display = 'none';
    document.getElementById('editSelectionPrompt').style.display = 'none';

    // Check if we're in EDIT mode
    const isEditMode = document.getElementById('editBtn').style.textDecoration === 'underline';

    if (isEditMode) {
        // Show the edit card for the selected agreement
        const editCard = document.getElementById(formId + '-edit-card');
        if (editCard) {
            editCard.style.display = 'block';
            editCard.classList.add('active');
            // Update stats for this agreement
            updateAgreementStats(formId);
            console.log(formId)
            // Update the title dynamically
            const titleDiv = editCard.querySelector('div[id$="-edit-title"]');
            if (titleDiv) {
                titleDiv.textContent = `EDITING: ${editCard.id.replace('-edit-card', '').replace('_', ' ').toUpperCase()} AGREEMENT`;
            }
        }
    } else {
        // Show the normal form in insert mode
        const form = document.getElementById(formId + '-form');
        if (form) {
            form.style.display = 'block';
            form.classList.add('active');
        }
    }
}

function toggleDropdown(element) {
    element.classList.toggle('open');
    console.log('Dropdown toggled:', element);
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded');
    document.getElementById('selectionPrompt').style.display = 'block';
    document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
        el.style.pointerEvents = 'none';
        el.style.opacity = '0.5';
    });

    // Add event listeners to all file inputs
    document.querySelectorAll('.file-input').forEach(input => {
        input.addEventListener('change', handleFileUpload);
        console.log('File input event listener added:', input);
    });

    // PDF viewer close button
    document.getElementById('pdfViewerClose').addEventListener('click', closePdfViewer);
    console.log('PDF viewer close button event listener added');

    // PDF navigation buttons
    document.getElementById('pdfPrevPage').addEventListener('click', () => navigatePdf(-1));
    document.getElementById('pdfNextPage').addEventListener('click', () => navigatePdf(1));
    console.log('PDF navigation buttons event listeners added');

    // INSERT button functionality
    document.getElementById('insertBtn').addEventListener('click', function() {
        document.getElementById('insertBtn').style.textDecoration = 'none';
    document.getElementById('editBtn').style.textDecoration = 'none';
    document.getElementById('viewBtn').style.textDecoration = 'none';

    // Add underline to INSERT only
    this.style.textDecoration = 'underline';
        // Enable aside and forms
        document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
            el.style.pointerEvents = 'auto';
            el.style.opacity = '1';
        });
        // Visually highlight INSERT
        this.style.textDecoration = 'underline';
        document.getElementById('editBtn').style.textDecoration = 'none';

        // Show insert prompt, hide edit prompt
        document.getElementById('selectionPrompt').style.display = 'block';
        document.getElementById('editSelectionPrompt').style.display = 'none';

        // Reset forms
        document.querySelectorAll('.form-card').forEach(f => f.classList.remove('active'));
        document.getElementById('view-form').style.display = 'none';
    });

    // EDIT button functionality
    document.getElementById('editBtn').addEventListener('click', function() {
            // Remove underline from all
    document.getElementById('insertBtn').style.textDecoration = 'none';
    document.getElementById('editBtn').style.textDecoration = 'none';
    document.getElementById('viewBtn').style.textDecoration = 'none';

    // Add underline to EDIT only
    this.style.textDecoration = 'underline';
        document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
            el.style.pointerEvents = 'auto';
            el.style.opacity = '1';
        });
        this.style.textDecoration = 'underline';
        document.getElementById('insertBtn').style.textDecoration = 'none';

        // Show edit prompt, hide insert prompt
        document.getElementById('selectionPrompt').style.display = 'none';
        document.getElementById('editSelectionPrompt').style.display = 'block';

        // Hide all forms
        document.querySelectorAll('.form-card').forEach(f => f.classList.remove('active'));
        document.getElementById('view-form').style.display = 'none';
    });

    //VIEW button functionality
    document.getElementById('viewBtn').addEventListener('click', function() {
    // Disable aside and forms
     // Remove underline from all
    document.getElementById('insertBtn').style.textDecoration = 'none';
    document.getElementById('editBtn').style.textDecoration = 'none';
    document.getElementById('viewBtn').style.textDecoration = 'none';

    // Add underline to VIEW only
    this.style.textDecoration = 'underline';
    document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
        el.style.pointerEvents = 'none';
        el.style.opacity = '0.5';
    });

    // Visually highlight VIEW
    this.style.textDecoration = 'underline';
    document.getElementById('insertBtn').style.textDecoration = 'none';
    document.getElementById('editBtn').style.textDecoration = 'none';

    // Hide all forms
    document.querySelectorAll('.form-card').forEach(f => {
        f.classList.remove('active');
        f.style.display = 'none';
    });

    // Hide prompts
    document.getElementById('selectionPrompt').style.display = 'none';
    document.getElementById('editSelectionPrompt').style.display = 'none';

    // Show the view card
    var viewCard = document.getElementById('view-form');
    if (viewCard) {
        viewCard.style.display = 'block';
        viewCard.classList.add('active');
        viewCard.style.background = '#E5B299';
    }
});

    // --- BMC SEARCH FUNCTIONALITY ---
    const bmcSearchInput = document.querySelector('#bmc-edit-card input[type="text"][placeholder^="SEARCH"]');
    const bmcSearchIcon = document.querySelector('#bmc-edit-card .fa-search');
    const bmcSearchResult = document.getElementById('bmc-search-result');

    function renderBmcResultCard(data) {
        if (!data || data.length === 0) {
            bmcSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">No results found (Either it is a complete document or you entered the wrong location)</div>';
            return;
        }
        // Show only the first result for now
        const bmc = data[0];
        window.currentBmcId = bmc.id;
        console.log("The bmc id is",bmc.id)
        // Place this inside your renderBmcResultCard function
bmcSearchResult.innerHTML = `
    <div style="
        background: #DEBA9D;
        border-radius: 18px;
        padding: 28px 28px 28px 28px;
        margin: 18px 0 0 0;
        color: #2C2C2C;
        font-size: 1rem;
        box-shadow: 0 2px 12px rgba(0,0,0,0.10);
        width: 100%;
        box-sizing: border-box;
    ">
        <div style="display: flex; font-weight: 700; gap: 24px; border-bottom: 1px solid #c9a98b; padding-bottom: 8px;">
            <div style="flex:1;">ZONE</div>
            <div style="flex:1;">LOCATION</div>
            <div style="flex:1;">CONTRACTOR</div>
            <div style="flex:1;">DOCUMENT STATUS</div>
            <div style="flex:1;">MISSING DOCUMENT</div>
        </div>
        <div style="display: flex; gap: 24px; margin-top: 8px; margin-bottom: 24px;">
    <div style="flex:1;">${bmc.zone}</div>
    <div style="flex:1;">${bmc.location}</div>
    <div style="flex:1;">${bmc.contractor}</div>
    <div style="flex:1;">
        <select id="edit-doc-status" style="padding: 6px 12px; border-radius: 8px; background: #DEBA9D; font-weight: 500;">
            <option value="INCOMPLETE" ${bmc.document_status === 'INCOMPLETE' ? 'selected' : ''}>INCOMPLETE</option>
            <option value="COMPLETE" ${bmc.document_status === 'COMPLETE' ? 'selected' : ''}>COMPLETE</option>
        </select>
    </div>
    <div style="flex:1;">
    <input id="edit-missing-document" type="text" value="${bmc.pending_document || ''}" style="width:90%;padding:6px 10px;border-radius:8px;border:1px solid #c9a98b;background:#fff;color:#333;font-size:1rem;">
</div>
</div>
        <div style="display: flex; justify-content: center;">
    <div style="
        border: 2px dashed #b48b5a;
        border-radius: 16px;
        padding: 18px 32px;
        background: #D5CEA3;
        min-width: 220px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
    ">
        <div style="font-weight:600; margin-bottom:6px;">DOCUMENT</div>
        ${
            bmc.document_url
            ? `<span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <a href="${bmc.document_url}" target="_blank" style="color:#8a5c2b; text-decoration: none; pointer-events: none; cursor: default;" id="bmc-doc-link">${bmc.document_name}</a>
                    <span style="cursor:pointer;" id="bmc-doc-edit">
                        <i class="fas fa-edit" style="color:#8a5c2b; font-size:1.1rem;" title="View/Edit PDF"></i>
                        
                    </span>
               </span>
               <!-- Add this after the document name/edit icon in your JS template -->
                <div style="margin-top:18px; padding-left:11px">
                    <label for="insertPdfInput" style="background:#A0C49D; color:#333; padding:10px 10px 10px 10px; border-radius:8px; cursor:pointer; font-weight:500;">
                        UPLOAD PDF
                        <input type="file" id="insertPdfInput" accept="application/pdf" style="display:none;">
                    </label>
                    <span id="insertPdfFilename" style="margin-left:10px; color:#8a5c2b; font-size:0.95rem;"></span>
                </div>
               `
            : `<span style="color:#b48b5a;">No document uploaded</span>`
        }
            
        </div>
        
</div>
<div style="text-align:center; margin-top:24px;">
    <button id="bmc-edit-submit" style="background:#8A784E; color:#000; border:none; border-radius:8px; padding:10px 32px; font-size:1.1rem; cursor:pointer;">
        SUBMIT
    </button>
</div>
</div>
    </div>
`;

setTimeout(() => {
    // Edit icon logic
    const editIcon = document.getElementById('bmc-doc-edit');
    if (editIcon) {
        editIcon.addEventListener('click', function() {
            const docLink = document.getElementById('bmc-doc-link');
            if (docLink && docLink.href) {
                openPdfInModal(docLink.href);
            }
        });
    }

    // Insert PDF logic
    const insertInput = document.getElementById('insertPdfInput');
    const insertFilename = document.getElementById('insertPdfFilename');
    let insertedPdfFile = null;

    if (insertInput) {
        insertInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                insertFilename.textContent = file.name;
                insertedPdfFile = file;
            } else {
                insertFilename.textContent = '';
                insertedPdfFile = null;
                alert('Please select a valid PDF file.');
            }
        });
    }

    // Submit button logic for merging PDF
    const submitBtn = document.getElementById('bmc-edit-submit');
    if (submitBtn) {
        submitBtn.addEventListener('click', function() {
            const statusSelect = document.getElementById('edit-doc-status');
            // Get BMC ID from global variable set in renderBmcResultCard
            const bmcId = window.currentBmcId;
            if (!bmcId) {
                alert('BMC ID not found.');
                return;
            }
            if (!insertedPdfFile) {
                alert('Please select a PDF to insert.');
                return;
            }
            
            const formData = new FormData();
            formData.append('document_status', statusSelect.value);
            formData.append('insert_pdf', insertedPdfFile);
            const missingDocInput = document.getElementById('edit-missing-document');
            formData.append('pending_document', missingDocInput ? missingDocInput.value : '');

            fetch(`/bmc/edit-merge/${bmcId}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
            .then(res => res.json())
            .then(data => {
                console.log('BMC edit-merge response:', data); // <-- Debug log
                if (data.success) {
                    // --- CHANGED: Show the success message in the edit card, just like insert ---
                    const editCard = document.getElementById('bmc-edit-card');
                    const successMsg = editCard.querySelector('.form-success-message');
                    if (successMsg) {
                        successMsg.style.display = 'flex';
                    }
                    editCard.classList.add('success-active');
                    // Hide the card and reset after 2 seconds
                    setTimeout(() => {
                        if (successMsg) successMsg.style.display = 'none';
                        editCard.classList.remove('success-active');
                        editCard.style.display = 'none';
                        // Optionally, clear the search result or refresh stats here
                        bmcSearchResult.innerHTML = '';
                        updateBmcStats();
                    }, 2000);
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(err => {
                alert('Error: ' + err.message);
            });
        });
    }
}, 100); // slight delay to ensure DOM is updated

// Helper to get CSRF token from cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}


    }

    function searchBmcAgreement() {
        const query = bmcSearchInput.value.trim();
        if (!query) {
            bmcSearchResult.innerHTML = '';
            return;
        }
        fetch(`/bmc/search/?q=${encodeURIComponent(query)}`)
            .then(res => res.json())
            .then(data => renderBmcResultCard(data.results))
            .catch(() => {
                bmcSearchResult.innerHTML = '<div style="margin:20px 0; color:#fff; text-align:center;">Error fetching data.</div>';
            });
    }

    if (bmcSearchInput && bmcSearchIcon) {
        // Search on icon click
        bmcSearchIcon.parentElement.addEventListener('click', searchBmcAgreement);
        // Optional: Search on Enter key
        bmcSearchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchBmcAgreement();
            }
        });
    }
});

// PDF.js library - required for rendering PDFs

let currentPdf = null;
let currentPageNum = 1;
let totalPages = 1;

function handleFileUpload(event) {
    const file = event.target.files[0];
    console.log('handleFileUpload called. File:', file);
    if (!file) return;

    if (file.type === 'application/pdf') {
        console.log('PDF file detected:', file.name);
        // Show loading state
        const uploadContainer = event.target.closest('.upload-container');
        const uploadLabel = uploadContainer.querySelector('.upload-label');
        uploadLabel.textContent = 'Loading PDF...';

        // Show the modal instantly
        document.getElementById('pdfViewerModal').style.display = 'flex';
        document.getElementById('pdfViewerContent').innerHTML = '<div style="color:#096B68;font-size:1.2rem;margin:40px;">Loading PDF...</div>';
        document.getElementById('pdfPageInfo').textContent = '';
        document.getElementById('pdfPrevPage').disabled = true;
        document.getElementById('pdfNextPage').disabled = true;
        console.log('PDF modal displayed, loading message shown.');

        // Process PDF file
        const fileReader = new FileReader();
        // ...existing code...
fileReader.onload = function() {
    console.log('FileReader onload triggered');
    const typedArray = new Uint8Array(this.result);
    console.log('TypedArray created, calling renderPdf');
    renderPdf(typedArray);

    // Reset upload label
    uploadLabel.textContent = 'PDF UPLOADED!';

    // Show file name just below the label
    let fileNameDiv = uploadContainer.querySelector('.upload-filename');
    if (!fileNameDiv) {
        fileNameDiv = document.createElement('div');
        fileNameDiv.className = 'upload-filename';
        uploadLabel.insertAdjacentElement('afterend', fileNameDiv);
    }
    fileNameDiv.textContent = file.name;
};
        fileReader.onerror = function(e) {
            console.error('FileReader error:', e);
        };
        fileReader.readAsArrayBuffer(file);
    } else {
        console.log('Non-PDF file detected:', file.name);
        const uploadContainer = event.target.closest('.upload-container');
        const uploadLabel = uploadContainer.querySelector('.upload-label');
        uploadLabel.textContent = file.name;
    }
}

function renderPdf(pdfData) {
    console.log('renderPdf called');
    pdfjsLib.getDocument(pdfData).promise.then(function(pdf) {
        console.log('PDF loaded:', pdf);
        currentPdf = pdf;
        totalPages = pdf.numPages;
        currentPageNum = 1;
        console.log('PDF has', totalPages, 'pages');

        // Render only the first page
        renderPage(pdf, currentPageNum);

        // Update page info and navigation
        document.getElementById('pdfPageInfo').textContent = `Page 1 of ${totalPages}`;
        document.getElementById('pdfPrevPage').disabled = true;
        document.getElementById('pdfNextPage').disabled = totalPages <= 1;
    }).catch(function(error) {
        console.error('PDF error:', error);
        alert('Error loading PDF. Please try another file.');
        closePdfViewer();
    });
}

let isRenderingPdfPage = false;

function renderPage(pdf, pageNum) {
    isRenderingPdfPage = true;
    console.log('renderPage called for page:', pageNum);
    pdf.getPage(pageNum).then(function(page) {
        console.log('Got page:', pageNum);
        const viewerContent = document.getElementById('pdfViewerContent');
        const containerWidth = viewerContent.clientWidth - 40;
        const containerHeight = viewerContent.clientHeight - 40;
        const viewport = page.getViewport({ scale: 1.0 });
        let scale = Math.min(
            containerWidth / viewport.width,
            containerHeight / viewport.height
        );
        scale = Math.max(scale, 1.0);
        const scaledViewport = page.getViewport({ scale: scale });
        viewerContent.innerHTML = '';
        const pageContainer = document.createElement('div');
        pageContainer.className = 'pdf-page-container';
        const pageNumber = document.createElement('div');
        pageNumber.className = 'pdf-page-number';
        pageNumber.textContent = `Page ${pageNum}`;
        pageContainer.appendChild(pageNumber);
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.height = Math.round(scaledViewport.height);
        canvas.width = Math.round(scaledViewport.width);
        pageContainer.appendChild(canvas);
        viewerContent.appendChild(pageContainer);

        page.render({
            canvasContext: context,
            viewport: scaledViewport
        }).promise.then(function() {
            console.log('Page rendered:', pageNum);
            setTimeout(() => {
                isRenderingPdfPage = false;
            }, 300); // 300ms lock to prevent rapid navigation
        });
    });
}

function navigatePdf(direction) {
    if (isRenderingPdfPage) {
        console.log('Navigation blocked: rendering in progress');
        return;
    }
    console.log('navigatePdf called. Direction:', direction);
    const newPageNum = currentPageNum + direction;
    if (newPageNum < 1 || newPageNum > totalPages) {
        console.log('Navigation out of bounds:', newPageNum);
        return;
    }
    currentPageNum = newPageNum;
    renderPage(currentPdf, currentPageNum);
    document.getElementById('pdfPageInfo').textContent = `Page ${currentPageNum} of ${totalPages}`;
    document.getElementById('pdfPrevPage').disabled = currentPageNum === 1;
    document.getElementById('pdfNextPage').disabled = currentPageNum === totalPages;
}

function closePdfViewer() {
    console.log('closePdfViewer called');
    document.getElementById('pdfViewerModal').style.display = 'none';
    currentPdf = null;
    document.getElementById('pdfViewerContent').innerHTML = '';
    document.getElementById('pdfPageInfo').textContent = '';
}

document.addEventListener('DOMContentLoaded', function() {
    // --- 1. By default, show VIEW card and underline VIEW ---
    setViewMode();

    // --- 2. INSERT button ---
    document.getElementById('insertBtn').addEventListener('click', function() {
        setInsertMode();
    });

    // --- 3. EDIT button ---
    document.getElementById('editBtn').addEventListener('click', function() {
        setEditMode();
    });

    // --- 4. VIEW button ---
    document.getElementById('viewBtn').addEventListener('click', function() {
        setViewMode();
    });

    // --- 5. Add event listeners to all file inputs ---
    document.querySelectorAll('.file-input').forEach(input => {
        input.addEventListener('change', handleFileUpload);
        // console.log('File input event listener added:', input);
    });

    // --- 6. PDF viewer close button ---
    document.getElementById('pdfViewerClose').addEventListener('click', closePdfViewer);

    // --- 7. PDF navigation buttons ---
    document.getElementById('pdfPrevPage').addEventListener('click', () => navigatePdf(-1));
    document.getElementById('pdfNextPage').addEventListener('click', () => navigatePdf(1));

    // --- 8. Utility functions for modes ---
    function setViewMode() {
        // Underline only VIEW
        document.getElementById('insertBtn').style.textDecoration = 'none';
        document.getElementById('editBtn').style.textDecoration = 'none';
        document.getElementById('viewBtn').style.textDecoration = 'underline';

        // Disable aside and fade it
        document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
            el.style.pointerEvents = 'none';
            el.style.opacity = '0.5';
        });

        // Hide all forms
        document.querySelectorAll('.form-card').forEach(f => {
            f.classList.remove('active');
            f.style.display = 'none';
        });

        // Hide prompts
        document.getElementById('selectionPrompt').style.display = 'none';
        document.getElementById('editSelectionPrompt').style.display = 'none';

        // Show the view card
        var viewCard = document.getElementById('view-form');
        if (viewCard) {
            viewCard.style.display = 'block';
            viewCard.classList.add('active');
            viewCard.style.background = '#E5B299';
        }
    }

    function setInsertMode() {
        // Underline only INSERT
        document.getElementById('insertBtn').style.textDecoration = 'underline';
        document.getElementById('editBtn').style.textDecoration = 'none';
        document.getElementById('viewBtn').style.textDecoration = 'none';

        // Enable aside and restore opacity
        document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
            el.style.pointerEvents = 'auto';
            el.style.opacity = '1';
        });

        // Hide all forms
        document.querySelectorAll('.form-card').forEach(f => {
            f.classList.remove('active');
            f.style.display = 'none';
        });

        // Hide view card
        document.getElementById('view-form').style.display = 'none';

        // Show insert prompt, hide edit prompt
        document.getElementById('selectionPrompt').style.display = 'block';
        document.getElementById('editSelectionPrompt').style.display = 'none';
    }

    function setEditMode() {
        // Underline only EDIT
        document.getElementById('insertBtn').style.textDecoration = 'none';
        document.getElementById('editBtn').style.textDecoration = 'underline';
        document.getElementById('viewBtn').style.textDecoration = 'none';

        // Enable aside and restore opacity
        document.querySelectorAll('.aside-card, .aside-item, .aside-subitem').forEach(el => {
            el.style.pointerEvents = 'auto';
            el.style.opacity = '1';
        });

        // Hide all forms
        document.querySelectorAll('.form-card').forEach(f => {
            f.classList.remove('active');
            f.style.display = 'none';
        });

        // Hide view card
        document.getElementById('view-form').style.display = 'none';

        // Show edit prompt, hide insert prompt
        document.getElementById('selectionPrompt').style.display = 'none';
        document.getElementById('editSelectionPrompt').style.display = 'block';
    }
});

// HARD REFRESH FUCNTIONALITY 
    document.getElementById('refreshIcon').addEventListener('click', function() {
        window.location.href = window.location.href.split('?')[0] + '?hard_refresh=' + Date.now(); 
    });

    // Tooltip hover effects remain the same
    const refreshIcon = document.getElementById('refreshIcon');
    refreshIcon.addEventListener('mouseenter', function() {
        this.querySelector('.tooltip').style.opacity = '1';
        this.style.transform = 'rotate(360deg)';
    });
    refreshIcon.addEventListener('mouseleave', function() {
        this.querySelector('.tooltip').style.opacity = '0';
        this.style.transform = 'rotate(0deg)';
    });
 // Smooth scroll to top function
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'  // Makes the scroll smooth instead of instant
        });
    }
</script>
{% endblock %}